`default_nettype none
`include "USB.svh"
`include "USBPkg.pkg"

//////
////// USB Serial Interface Engine 18-341
////// Device module
//////
module USBDevice #(parameter DEVICE_ADDR=`DEVICE_ADDR, DATA_ENDP=`DATA_ENDP,
                             ADDR_ENDP=`ADDR_ENDP) (
    USBWires wires,
    input logic clock, reset_n,
    output debug_pkt_t debug_pkt_ext);

  `protected
I(Cd3NcZI/e&A5KJ85/CNYJ/-I6GUCG.CZK5W/L^S6)W<RS-Xe;.5):N9;HU_U87
,(7[JIEQX77?+O(XI;@.SGCLE,&BE4)G0H>QDa,EHA]#;QOVG6:N\eH++F1@R&cb
2eDN\f_CJZP&[L3TT^f2f++/3PX89PWG3O?NC6=JbJ.[X+/SOf?I7Ob++TaKDe.P
QA8eO7dW9E3,>4Uf;18dWAL<6?B]I5COG?Z?)cF^E2.d8MZ<3T2ZNF9@Ec9WEc_X
MS3^@8VDQ9a:P&:BOFW9QXNcK1L5(PQ;E4AKGdfE8^UggcebgbH\_?=b-\02<.-9
&>NAQHcX76(I+CRT/PR8UJ&P-06Q576d\a?Ja7_FeX2cd.@)+:IRgF;)N0DRKE/f
-YH8>/:Id64[W<4#W[9OO6_cb+e>;WbF5:YT0e<WXgXO,aEf20,Y(9c7?QN(WU?\
1E_6&C7+W<_,_@]]3:6[:^JH4^]R0>P;-UbcV)XOU<WGHF9XW/?KSL&K-)^aNKXQ
L9>B&V&(<\#Oa:MC0dQ3:06XCQ8LKL>0dFCCT=^1OVZK)8(b/+UTC+;+SA?gP):1
46VM>EP6;A\5?HRKB,#J[?U8W/VD;9BYfL2+Y3,,#.b=RCK7<,6gZCa]NK7FXYWQ
>F:X=/D5I&2S??GONO(b>GR>1Jd8bAV1NSBNYM#MI=(1WA)(J@878eL#^O(5a#:;
:+M&DL/B1A<E9a5O:SA>45W^Qc_\;cg8d_dP@Q4fQ\X&O8@<T(_/NQ-^bRHN>J6-
SWZcZ0O/O,a&cC?UXPV3MVKTX[R^[P=<;8,a<3/U8L6GQ?Ng5?57b7gJ?cLEX<2P
;7GHX[#6X\d)BVB+O@9A/R4d3E-R^e4MB3DP#P6B2RLS?_1a7\PbONBUKSEc_X59
N;=21Vda]9Wg61660T5Y8JSZ/]WUS)MY+G\afQ/g44gQ)LUf8][1IHAY4J04Q.C2
X^<,,^+O7JL6d^2;+R])UX[:^Q=@aY-K2P3cH\3CGe@TX91U)[AYUEN5#NeM&JQ/
IB-IC_XE(?0MFAT&BaDGTa.fTYN/M6>5=XF;SVe>,Ec+\@^@,[Zc<C<W(De,AdgN
X&dC=KdSGY4b,?b7GHHQG.G9F>48LXUX;PAL))07cV\:29G0#K^^_\H.0\:\GJ:V
/eg7X_;.WM)]aQ1=GG8OP1FBdbIgV3D,;7XWaMHE99H3,?58fW^JQFI5Jb0[1/eJ
ccA(d6Pb@+)R3.MWK?\46JH+48S72f&,;Y6g;A6-e:6D<_5IX;9cd\]@@#AMa.,=
4HHNAK0Ze>0:2dbOCdG8Wa^^Sa?@e5P;.O0&8T0MS(KaC4d;c_P+,<0EC(@+dbdc
CZE8bf12:<]1@99-#W+(^c^f3eCARC1#TOCN;a8FDYSBb8:,Z#BW3.PO44EG8GG>
W(1<fc(>5Y[]UZ:[5NDO#-LP/U6WVJaB\B&AX^-24A[;4T5#J+P.GHJaMeYYO-e[
C7]\Vc>F))[A;<_+2:QRXR^4.O+(OAE:dYYOffPBSR0EP;P+DBGdYCWQ3Q;+<:H/
4.LQFEKZG4c,BO(C;2N;7[<b9?0NM1OD7+UbdXSOaY@5)]MTcPE]OB37SMf[SC=O
d[9\(W7:RN\=.)SWBRc09K5T)Y@1VL@5gPbbR?<8K5(fZ8#?A8.N-4VGHc#>2&+N
E8F0AO_8W)XU0,CPWbfZBZ\^SW<Y\GG<Q]f8@YC7QD/Qg5.;AaZ4@gM(^[:aNbQ-
Pcge-D+:8a?XE?I6&/c-C>\ML.g=(MM:)MPeg-We_2JIcW\SV]:FV<8MfQ4O52BV
D2_AaI-HL2G1^cXU-d:N;)_1R6J2?d^XAZ[3AMXc8Md6<;.MNWGfgHHRW^[,FF7U
A3_[5N&@Q:=P\O,e-]&7KRJ?;M<H24KS9+=IQCG_&IBJab.(NAP[JI4?c:&UYA^4
^T=FG4/IM9:]?_6;DZF^I<bY9.9C.f#ca6/eL2N)R53]#FWe;L8G7Vd[Le=-F7\&
_KV@=ZDLMcf?@79T9J_ePXIC(.:I:DYI]_@@+=W;7M@HVc=)<fPKDBTO)UB^>_7R
6UGL56M9cK1^+#Z-OL<VQ0a&14^b7+O=>^<T<F-T=M@aU;eRO6F-DWGR/949H7(,
DTYYDV>=L4/5VP+N#))DL<V@LU.e,QY7;=-((\YE3dDRVK;+U7A#I1)YA+WT5bPA
5?;ULGa(eA(ZW=7XdW;c.0?Z_>DN:Sf&5Gdc8a.ZDVD3K.3I\S<=:3CE1@GgET6^
]1T8OX,GWB5:14L7YfJT,LFXC)I]-Z2Q,W=N#T,0EZ,.I0VP@Rf#GZ\:[#B;X3dc
]D#P]L-\8eSG-+\A7,f@F,L?--D]3_EE)V=(&fE:E3(0^.+WJQDA:f.DI<7.QeN-
L6a7&3TK4^KgTS(5=7TJNeBZe=c/6O;Id4/17&9-Xa?BCaI0f0)G/W<T3-,1Qc+=
\K0\,7_MY.R<>\>[8^==IATGTR:)S_?cQHMT+[daU.N@7U2M<ICPZ8/]J5g@JKP1
:cT3)/HY.Z=+2WWLMN]Q2FLLd=^;=-2<@-J=4Cf@S7GaS^1MDaI<MD_bM_<7ZSDK
,D1<[UXId./G:)W,LMJa4<bec]-W4EQaQa0/?cBf]&@(NP\+;V#@J#=\P4,\<0[S
7PJI1+JXbHO,L.6&ePKK,?b@^fX<4P_RAagMg?RZOH-;fZ7R#8G^e4KT-X]8PCf4
fS1;(M#W1?H6E7]d/;-]C]Z]FU)N=gT07.@]VH&L^VW7KUFH8^23MfFZ#SPO]&)-
,4be^P\\?6:[g2H7I_).)=N6.7Q;Y-3Q-_eU1KfJZ_;B=;d=[b?[bZ9509K>-R9,
DPS943(6Z-TFUZY(g[d;[AO51ZQPXK00]C\\:C5.d3+G-ALLdV1QWOFaD1.+7B:<
)PKBD:KA_TROU78/-eNaO#1<\>7XGM+8@eO1NFR.GJAWN\L?]faTc17;[gg.9PT6
d\NSKVeW&=:7YJ2/27WWRH9<L.Qd#INA73fJ=\/66cSSWB2QPbJ(,4(YT=-]^5N0
IS?CW42057a+@[4TB@97+VX3b7HXf;HgcW+=L>RMc7M0GN?QI<PHJ9^ON/7f(R<?
/D0O(e0(S63(?+b>b9/.TY[\&-JH4L-W>a)Y38.WI9HE9></2fM8.U9)+W]#D+Y\
1>eH5^VE]EJ>:E1b\8d@94D2^cQ@M\SZ[5<I_=,Mg]BX20#LB\f3)J7RWVEJD;FA
)E>8J5g<3L(YBSABP.TF;\3UD+P^R;#d(;O>(&AJ@1.KBfCLC[UTA:LAdX4M2;=6
/89OcY>22BN-[UO?-JbB5HaQS:a,\=O:,7UW^1]D+T@7-1-IH@:)NA,E/=&CP_8U
9HOV<[67ZeK_D;fZd55U8[@.aXY>0P_1.8&^D:\O2DZF7[d\V_Q1IBcEfb3L.K;\
f)PP.,YaUNGY1E0?BQPdJMV>JDY)#R@/FJeW3=EOF:>H<(Pce.P)W@9VbGJB>O1R
CS2,Cb0d]F94F@60gRB;R9O>@>R?Y_[B&8U609,<#SDIS4DK)H13Z_7RB7:H^(@g
cZJY(-81#78\S.?M8LCNZBce0#]3_#]<gT#5XYF[ZEEH89^O(=I0f=cX61@W)-(9
08Xf9cJ,^.DO#g[DRK(a40LW0&)7BM9g7)\52<c.,f-NSe9&)?WYSf[@TS1XKBT7
X7-1&<+,K1:a0>L1cbRX-I_;AV(0V@(=4]eUVNM<;CQ5T>G4cEKY/_H6.Z;K4L:L
\a5JH)?7Oe]R#T#)f<F/Y?#/7QVAeSf&<d\R9a70XgaFC4HHafcX<[=\K[)K@).9
K4RDa&&R+I=gQ0XF66?YX-_<\PFEAH.f8(/I4S:YdU#M<<QU>NMV02Y+7X<b7U@9
.MOFDN0#?;QgJ?Mg(H1L;KZS,cV<,R;Y@#BAI211;ePWNI2E\4-6Sb=ZVL_)_f/?
XPM790]5H/@U>Tg6^EUP6FEK.+SMO)W_YB>B@c5Y0MDEcZdHQYZJF;b_3b<:SB43
[M6;d4(AV^=Y#/SXXWW?2Q1<NK++H-0T?fR=-CG,6ONMBaLYT<f,(/&YM3Fb2P\D
/EDZKA,66FG8-JI[3#3ebB06f@X<X5X?#Q=2:4>37--#:/WXI33F_aM4XfF(IP>V
@APQ<GLd9TK+208>96R[HNX1_5[d@M^f1cLaX&92=2.4G0U@14;3LfXf#G1.CCdC
.>@O_8E(H9FT5K1_;\_;F;>8=2-W=+XJRP=P<3AdLS5GEO.3C>MFK4^MDPeLE0g0
25P>O+6Z+3S0]?K@:5:2\ZGbCHXN[X&g+8.4)HEBb?R43VYD?SLUCPaDC,,/_2/[
_V/,f\#O4&_,:]WR7TL1c48GF/bS).&b;[#c6PQ.b3Qb:c;4U.U/>>XLLI<Q1Yb7
<IVcXV//QY1YcK0N@TW0gfH,_49bGB_?eYfN_JJ)0]+(/:5)^4=f&R(B3[fO<;I?
Ac<G-58cQI,e_gQR@[Y<B#:];YFHTM)Y.dc@\47)eF:V0^N6VZ3W4BFY?AYN=VDW
5@RSYZN27I4NOF,SLGL[EZO4IBT,P<5ZSLF]E:I;1<N3R&ge7K&LM@^:;#@O\NMB
J,E^XH=T^#,]RDI&3Z@E+#f.^[W1[(V>9+9PXeR/NRbO5<BSg+L_?=KV,?7,_Zc_
YPMVG>LO-&I>N)5MH_LZ,QC-WI,d,Pa@ZV.W&R,bK_[:1/dK=SZ>R:4DG@6g0]be
@>5#=1:g;S9M76B1fL0g.dJ(Nc(6&BMPK]A3[@&YO75V([A_6@[Ec4N<IeI3D9=5
A.HMJ-FUB-L^]IGWccM#<>W7#D.eC24N5bK(E9D+>&SX?G);Mc-5)ZS6=N8GeeAM
-AfD?dAMf6#L:?ROLQ<U-#JAbU.C#Q.L[3g6&add7EG?<b(0a:_KM[:d5O:A,2<O
Jb198;95K(;L)bTR_QKg^B>6=ecW:OJJJgC3Q)MR&#fI<\[D5HEZ;/AA,RU1P85b
Z^PF(:V+JHORbDHV.b#YEVTTS==cXI22.BJ2M-2X+H.H3(DT41[RPJgGaEQfQ^,/
ZaS1,I?RB;=/RLWMG,H=<^IO,R+Q6+>23<5K(dOH\=?d(eA\#eQ\Q=YF2,c)AVXJ
YQ#K@12Oda/=&Z5@cP6>FY5dBLXG>0+9NV&9?GNHZC7YeXMQSf^3?RT,/_N/WJJ+
/8]3/2+2f&/B2,EQJ]c6A^0BEbK&^Q(4P?TI-B>eT+5VJ,XVNC@gCIc:<F_d..X#
Jf-)X>:,gfKgB3fbacJVF.P)Yg>_UXd(aDda3QMMC0K/bBG4V-.:ST3LIZ><ORBK
WKM1+E:K;1(?BH]3(4T+fc1?U^13L7F3LHBL(&P2_?EE_V]2L8XD4=?gY5,V)Dad
/;,/W?86-F3,f^gJ+GRB>,5EZCU_>#<2X1<b)^N_[?4K8fH]>&SE<dSF)9MYQaC#
25J+;IW-2Cc#d)6JHK<&5GFC8\a.K45FJc;e+R>@;4Z-OY0cDa.X8>>JdaI5L0D=
c,FWN5UgZJ=I<4UW_4-)<RJI>P8,64:L)TRd)^X+Z/Wf,IAI3)R<T_03eJUa;.Ea
]&/@9[b-?D8UUJ)U;)^:MH6R@<-BfZfda8XN;>ZL_QG1H+JfIAB0;TE#&9NE<I@e
-A:VE+d+W?2:J30d_F,>51gW@K)2H/_3,eWZZ#ef/>2(RHR@67K5<)dA=EZZB\aV
HGIZV]9H)O6cd-/3#LaR)g/Ea.T7FKJMG8R+fE\2bXOX:]YF8>Rg2PP33&4ODFN;
.O&_=#<.)Nd=)-FZ(.9V))1EZ8)Y\Sd<RA/RYD46[&g<BG<6KNTd22TB,:gKD;EP
U866Wg2-\BAXL+PIJ?=#HcSDZ<JN+?7CK_DK&7#C_[a94G.UU6J6RC3\44+[c&N0
XD5[@7NaX5S/YG&3[=JV.G#NdP-\@FJb-?-=/WB0E3SS3DJH7eE-bIB#)()E<7_c
#JV;[AKYc.(><6fHOW#]3a)aI<_18S0U8N-I^P(#)E0?V<Fd<1/9]BH?1d>JOMf7
XMQRH8W2Cd9__=>_.SD>R8,dCd9Z;#c&8&7Z5<)7YH(#\#P\e-MI30ea0J+#gTJR
9M35ge=JIaf6^9CC(E1g31#)SfU(U\R8HU]S?K+.^+@f1@?EgOF=aJ\@^5XU;=J7
@CeI9UBJg->d9YM-1+PMMQ]Z?1)5R=_RT?^PD_&(Q8=8(0gU>b<X-O1_KU0H+(-@
Z;@G#fP)/)1?,]cF+^S89&@H#.)Xe8JL,g=ccY48X5W)HUO7GS/FWDO\<@>W?161
V@#(Y0ESC=STZ^UOW]FLC)<C(;@Be3cUd@.=W/0_RA41;>4f;Wa2VPM9A8d,JCMR
:FR_CP;N>B3fFXE/@#aJR15@Z=+c\+)-8&7+M6d<G0/>L(Z#WPYbg.J?0_)d^;3X
7;>/:;FW;(/XM=EYAIdGF/Y(]P:K-#N^&YN@JE;B>_dM+@X-LU;]>=#G,DLcN+#J
RE8SD).D<ZN;8bOdQW?LfAP1a:T;]acWG6HGZ.5\2KMY&N<=8H]3YZM@WW7W-O;T
?(H8-d@XW.PIA]]];E],Q@a1\9^:<>TQ:Zdb0@?\).JOHc<)g^&\_868QY4S&F/-
7[fMeW.?>92dS5gHS3eg_c6_Q@[7K#^8V=MW)d/edFR[O).-AdS14\24\9.Yg+=;
./PQ-5WC&B>6C<IS,/[C-R6(fOebg:[+4WN>=C@&PRP,YE1:f/V3/_,b/&T\HZ++
7M?H,OZg9H+PE;2OCb/]8EZ\&6VAXFXJ^d+L;:E=(AKM?E_P2KA#2<H)UT,M-TX\
dA^N\SD7+bD#W[C\:YCcFg,@K7(#X-Y6YPF7HC=NC4=B2^:^V=Q_RN9gO?,7bNc-
0Sc^D#SE?7UG,5AS>fNYKW0bJ^@;?5HJ(=+;0e5O0]AVSIQa3_+2TEIM.,+aA4Fg
_.0RL0,;4e.I,2^0Z,4S:\)a3RD;V&aMJOWb6&[M9&GEFA]gOVBRQY#&H<>(/O+a
RB=17-6A91I:\YYS]RDV^3_FX1[FSGQ9C=dG&QG(5=E1L=>D^I\6LZQgE4K&P7M1
dP6QXTH&YZ+I@6>4?@f-P3FK>&[JcW4NV?+3>g#UL(Y2+&I2Y[._+IO#M8#7D-K?
=OI\Kf(B69R,O.N3P2Jc_>MdY7TTG30^#JcRTO6&1G61SIQWa@4GQR2)La);8LTa
[(.P5^YQ.T<VZ-e&3,:KTMMd_7YO_4aA_SFb<N:9\Ta5A<R[a4PCY[WFZWf;7)3K
6LbcY)\RT[NA]:]:KE,-e[DNF:,fGZPGDR?[M,SV6=U0.+/=\bV;O0#]K[/+V=VG
,^D(;bd@WH1.Sab?8#8+aJ+T9YMP<;#;C9^3JbSBDJ\2@YWbVKXP5@@aOMS#Z,\Q
>a_F)FA(=a-g-)T2^&/;XX^_MKM)+(I:a#8-PK-?77MNH<X.>NWg;(HY[QYK@8dF
fGEAPZTM5:-g)77@COWG:^+LOKI-X94RLQF0RY+<3E<-_4IZC7]1IZ(=Ng,E0-UJ
N[[^K3^M\XPeC<RY,5bcU?+8Q@a-WJTcBdCY&<V.cS3R;I.2)g@KecZUc+>R^O-b
^AQ@\/4Cg2R.3.g.73:@eAL&3G?@(59,UQLRC]/#:BO?]I3/^M)2JbKSN5LC.5GL
-E,X2_a4cV:OQc9A9B(,R9CPZG1HLA3b]DR=W,#F)4\ff&/9T9&(O(H>&egQYEG:
_?=XMb8U&0FE8>AbY;R4BT;(K>RZ,O-Sc,b7EG97GJ;E\?cVY;&AP#MdIc;-QSQ@
IC2O<GW\E);Leg=0S_I5-dBZ]_C59^bZ>7g2Q.XZZ.@?#T:Kg5:>OUM5Jc,J,AbF
gNB=+cGZ3GQY_>E+8>7D\\P8W?_()^UJQ/:KZg7?Jb2SWd/AY][b55_bW4?#_9MN
P))eB/B/H8D>RaU/HO]AGR2>_P\d3&@S&c\0:G=6MP-E4=57M9W=SCJT\T4;f\_F
\\;RK?=NO?-VTc/_CVV<7,&ef07H9\H.)8>V4:)[_=87F^Y+dGBUedO(W.1&2Zf_
[WRVEN@>Q4f0I6:EDHgeg5;OK\V:^<E\>B_=Q;W1<cf?]TYaK4Kg,H<ABW^ND1g9
^_G]F9?C+:=[d3K68,7c8]EV(<^bc1dBP[WfbPOJa=[?.[,I>22E4#.N+X<?JaTV
g,(WSQQG](Y279]]AX+42(A=+5;^X2<FYG1YaDJ#[,aPAaE@HA75.EI.L-:OgWIK
9NZ.9[A(<7IEJWbRX08BIEY]?G5H3.E62IEUP=+2ZJ]]>L5#\\E9F.]80ZN,UX&2
@@T40V9/,:#K#a:cY-O&44#2<2Q;g^#GK\]A\=]CHZT&7N\U1]bQBRWbIQY[S6fe
4]c:):,9B&EDL+,TPb-G8F_H>AX&LeH<TVeFC^CQA+>?C\Dd-I04B)QPg=_#QNHH
E;/)bCK-GV=VR-:1SI5=#TL>5Y_UEZa33AN(V05fUUX]=D6cbWc@?PPS^54I3F[M
,9Pe9=e;L4UEA7A+@7B_ZfFKA,Q0G#PD/AR,2-,MRSGNOLP(&#SO=W5G+(c/BSF2
L7dT/4E)1X=\CIFZ&9W?^.1\:N\L>1V>QBZgL#22#6P7@ETR/Ie93H@;0(.CDRT;
Vb=IZ49_I=ZO,cIYPLV+KKBJDX_dDQ:W^Ac_59g<85W_b.X[M0:=TCZ?<^:=)&K?
56\.AED41)N8=]?e01=F:5T;QNbd+aO(:#IS=F80>90GaO]I,L]20JQVFPgBgMWO
YGcC)YFRd5;J-ZOH53N>d)EWD,>5>18<+@DC\7N4aETEM/GKPf/@_VT9;=b4VO3&
6F(;99I_(dLE,+f4J;eaXM^X^@+MdM\ZCe[[@d>gd69(Cg(=CVE1N;dWUHYc<,4Z
[8H06^S-^c,-J-N7:O?9K2OFCF39-;-:_0J0=7gD4A,EG).XK[F,?+H^_Z.TeJF+
=N63LQY)L[)bJ\S(8_TK82-9]W57L:-5=AWK=UOQI1G]Og+LT^a)edBL]CL]#M<E
S4?H-VXP;E>dDLYd5dCM^/NFXCF]e5A=X3_JM9PR]SaQ@V\#)agfX[d.?G/@_-LO
W]4_WI3EF1bHfYP5V3.ae]9Z=CZ=f5QDUP\[PC<_AafL#/U)^Q:+RF][P9_[5-bO
=-OQY\AUTURFP1^-Bd+UG3IZII=JDT,IRB(ea=^8H?<&b7P2B>TM0\5>XIE-.G<;
T#E^SLDRO)<+<^2HD5TRIdB>_/TICcM5;X.ANA3WI)_JZZT(5<RaN-TU9-K@(=X\
/.,Te4_=:ZV:_U5Y7?>5.38IFb;UH)[K0=G&.gV=[-/+WK:(@BIIGV7bK8a_g^Wd
A&PI.(0IG@]Lf\^F3Y3dgaU]4YS<^(7YeCff8ZF6X320PQgP_Ng>b?HLXZ.+\#E\
ES_PebFa,V:gDa2]BMCK+EOTHf4eAOA/3TgbM7-@H=-0>1T2O3O#8Y6gY#:\6(TZ
L_IZN69(RPdgV@HTL@1WD8e(K8EYO-1Tg]X;+T20:PP2(ACKH<@DZe?-:=L9:2;>
Sb;H,)MHH\1Z?(5)5RObDHOB6(,B(QO,L#K;\\J&_d\HZDaBJ#]aHRHF[->MYE8P
3QU;1+)Q^)]d,IY4b1,()\a@fAF_fU#FaLFPMH0J,2/:cUdbLcdIV_e@(9e)Z@/Q
fV>5\?&4O=EP7<\EfS/<QZCQ[cYZIWZZKYGcTV=EFcN#G7C\bHgeBHUN&L:N:UG5
L5WVJ9N#3,_9)L@_?Q>fRV0JG07F>eR&,U3&IN>21#]4XE/,F0T?19GETeTW#TB6
)Zd9O,,K:AG9;I<Y.c-ad\GbHB(R>;^0L;M3;U3ZNg>6CPeEQ[SSL2db7SaLPfL+
f3_XVNL.5>)L=6aM_J+))FUO0d&&L1+P>a>>1E1K+ST72)ELSgEY\IF08M=?Me]g
\A.PRVTN<R,SJ9<KCA:L<]^[<C;(P(&TFUDG]\J6>H,NeMdA=d1T6cFQ5PT+#,XC
BcAd=]MH5V^3BJ@Q[B,((VE+&&E;@YI]I^TN=WDY#)Y^YV;K2&<d@Z.IJIdef)?;
JGC+T^:@7-:+-MHf;?[]512O]&4H/,-N\P3J9E4-/+3QWe6&03G6O;S2AR5(DV[:
g?RF=F]3YANL=)5R=Y@LeZ7PbV9DHPGC^N_@D3/7ZH:=)W?D0C0]T8H#XJ=URFQ>
I^D5&_8W.d.(9TQAYe?T_]S7Q<L>0K5\;V+BO0<]?c1W/7fJgO81g0N;]3)T[FFF
fXW:ea?3J)C;PACNIgAPRCgdBeO([IeE)]dYEC+U4X1fK?]IGETb-7MPKD\[Q53:
+d7/?^YECERRfSRb2a81ZG0gU\S\4]QLI2c;b5g.(&UQ;T:_L,O.G<E3>Z(Q3V,1
Xa&,dK2(W\0.aPOO:A&a[&P(b+82GTK1g5B;>)71VY<LdL[&1[d-E-ge_;H/,5,Y
,caG>N6)\MI(R/QX;1@7&)VY1=J1@K^eUZCK+QH8^f/+\5B\KTH30+VT>C1ed,Vb
[X0M^>N.T9bRHe#d;eLLK^>(^U\3PK^G9/\DU1GL4AYD;^E8@Y+g<7Y=W]B)e712
.3X@FW-O?dK2(<Q+U0+LdYM_eA#&[5?C9+SX0Ud[(]eFF)Rg9b+HAT_0TAJ^VRAb
G+OJ?E@G8^U)X-YTfcU#[:TD?-;_QWPNRMHa2\HU9##5^)H#L&3P6RC7DLJO(SgK
6\Ig4H@gI4BN-\>g,TSeSe9+L3:aOaZ?KG+_aMOA3_bL;QMPTQ9&/Y++/R&3S>@V
H-<4&-#C5[Vf0DgDU6)&7V^SBd[gb:H#+T8=Ub8,b<8O(cB[9RbYIJHacbG9b;6R
NMKL6MLRKW83IJ6@7Q:S3:@)/gbgTE@51\[]3Aa<B+:Y[C)(HTE(:DL/.\V1@2I[
:[7)>:RW6:7X-UMNZabZR.8AKUd_SK&S:N7A2(g7Ha>f2T<</IOZF673aD\dga2^
DY]a&.VY7DG[Yg(@.UZCIU-F>H;4D(FE2>=5KN^S\1T/B6\/=5BRZ2fZLYdQWWL>
G)QB?,12dAbQOSY2aLV60b6eg33<2TBC^Ue^7&-:0/<IB&;K?0[CW^P#=\.R53B1
RgAU]FB8M&c-1G-M+HOEC3MYEOP9A#Wd0Z1JI@20F1#6Ie2Zf\.O./?279bN>NeJ
[4P1V/1H:3#>OX?U:9VB&M5LO8dDJCZ:SHN437LZA5E5Y(TMZ8BJC\S^6EfP#VR9
cPN_:1TU+Mb.A&4:PRWFXOd:W[WP\>#/9CL+a/7)P,4<#X7^cH_e[LL&G=1C_HAN
N4KcAQ40aZ8+7,DS4f=)0+O0[80I3-VcZdJK4E=@c@77MB[CNU5RO2cNI4):d^\+
c=bOYJcg.cHF&@JS[7Mc&Xdc(GC-A+9B:6HA&_7/:E>E=(IMC]ROX,JTP0NO8b;S
fY5+f<X,KG&Q?#YP)Y71TM&K)RWQ5Q.S#PT(O@[a7XABe+FO2Waf)=;f=Sg>NU>=
FG8==JO/PKd2b4\.:KCEcHdcFZg#SHfNA?J4IYERRG>@E1)D59)MQ<<T5c+\]S;(
J&5Q&W)J/O8_Y?N3X3_a8;,DAY@1[W)@g#/DAM5NBc]ORB1bJI+N>+#6d[<VDdQT
=aH0<g.YW#Tf+Dd.#70<6TWK+)W5I3df77KS#TSB8BRa_g(R;E56a8M4[YWLURB[
G&B41]V2[5>=gLEX#N>F?:;bDQM]E+2L=F+-#M6;YMQWC3VB[5/1W;T<-((>(KAO
7_#X+T?G:H_A;4<U^U52Vc<g3C:FC\WY:37H\JC:[M<:S]Qf9V1Qf;KIV2?(JGf>
g&FcM.YAFG&5aJ6-R,MDPKWVbSbLOSb>&^A,cV<D&\>C=#e6E)A\2&bFQ,9EdG>:
_-:]LNbS1E#K,M>?4gLS,OPOPdT;D0_P>8I>P8g+]J&d:F9;G(60/PLLLQ2\_=&7
H<_->[VPT9T((-:Q<B>cO8?4+7KY68;3[;H;7V59AEYC8TACJ8=SbHIG&<LQ+RQF
<U8I@GfJJ6Q(9.De1&6U)e:cBb8WEM,)SR<)I59D>KRB25UF<A5b?(&W,.1BJDMD
2S6;K#JeeTA91R]b?HWP&:cL6[e.A^aF/GLC:\P3FBI3=&DL5/@_<]K4ECEb=>KO
3_>7T.>ZNYTVHST4+e.YXH]dU^;^XDa&d5;a&T38Na@^Z,VEW-C;1IKYFJf1:Ka\
.+]d\DV^-dZ4;ANGGc9G<6JAL1^e7XBaMK]AM_.J.U):9]V-7Q?/eEQU&(&=67Y4
9/->8d-K]Qa2G?aaeIQ-A-/ae<FDR323P;57XFVF?B/B<NLSPe,bC[[FFS>;A4B5
-O6HB9SF_.83@IQTH>\,&T>/g<^HO4K&52E(f+2X^fL6I_@5RI-d2&6MNE)Z/K1Y
@]^^M4;TIY-HZ;d&\&>@+;MdCYc,cO[BCXYYgLf\0+c(:EIb;@32))>?],+.a&g/
cX^SWLOZ.f(.E:ZBOH>A/X46JM3TCB]W9.I0d@Q)V9M?WCKY\ee+b=E=]3cLA2M,
IF9MV#PAOG03:PeDf(O;G4f)\0/f/<8.^<(/R(d5ZBgBU1,C;W,1ZWP,OT?30&?[
]&Z#/&GV_(>LDC9ED6G8<-H,0;6?[.=.g<-A.+=7<B3fJfLEF+70OfAQS[#=MC37
Q04d[FI&27Ua;E.6:3B@5W@B7e2K=&\,Y&B,4^ZPQPA\U6RZ]dB^<-3<7\C/HRMf
\;@@g.),FBe27d<73S:H(]N#6gAPQgfZ6^42@Z9d7K+c1ZJCbBPY/FGB7Hg5-7G<
.V+KTU1W+_X)bgFH&LfR+_^cIa^XH&a:-F)P_N3_\IIY&eZRLPKCFZY\AObXT7bS
Q<d/8ZMJJMc/bc5SO:@R]g,UbFELf4BJE-;#,R++)ZbQ^]UGT1VBUY5Yc>b)eN3-
(VU.0&a52.01GZI++fZL5COG<O8UFJ?gYST>AS<Fd1eZ7+1OU2MDaN)1J+@OR=gR
R:Gcd9c(_?&:\]YLC?:-8N]M1LY4JSX0KV^8X,bgO#(?0(]9E7@g7X@Xf7fQ-(5;
f=3V8:OSBY8J;/e7.5CEf@8CfL6>7Y-)+DQN[#b)+9B3T>J;XS?;R3:N+WK8D#R>
8K@I0F0V>(O/OQ2#ISK;LLM4af2&=9._.S=dGc0B^UTS1:7=;<91P+b)E+8>_DC8
a<#1XcWNA[S0eQ03J@^UQW.9ccQ4SXFNVW0c4>_4ggH1c?UTCd9KUg)c91T+J6>A
,9fgF4LAF_,/+][&2\[U,]?U,Lb,8A^W5EOP)<XK2I+<4BAQa;(1KC47;ASNR_L?
/LZ2[?+b78Q#]OR5?G(cEf,P983c4PU+N^.[gOHd1FGMPT)RMWK0&):)8.J+A28H
9LM?BAR+A<+^f49)#S+5a1faROLG0B8+1-1U+@d++c6Tef2G_<&YcA/XYS0-D5,L
+^LNO@-92WJ0PRFBWC&&c4gAN[]fL[FaJGSK?AOD4C#H4&4IOONZ=H(3BGH0GQ_8
6f5G.=@7I)g?[5XHWTTO>bL<?g,+<S&VWU\d9\MGe7OX(c8gZc:B\QWZ-0f[2<?:
aG_2CY4aKSK7?#&9NA\:2^4DE+05O4>6(^@VOcN_[NZ(WQ(fX-:9VQA&-ODLAB9)
Cfdg@H,YX/4:E,UWB>VTf#FIOWOYd7ba)70Te7O.<+CW0aJ;g&GUOB@^64geFcF5
Yd)?,QAe70?W#4.9NN>6P@RFH1X5c#;geV2I,OF1N3?bNLF,)W=Q?W[/g_=6(=?@
5,5TXES+8[=QKVP-e69M]5+DN9?)31H::3[NZe8Y]1J?UTH9B8-N,MIDe(#e4gM4
29D./?43BW&(S_Jf5XR?>(?P)51?JH6U.ZAH#=U11]fS;c^aIW.[3.^d1_FCSW43
f,GH>[W(NT_M9RA-?L\N<8dMaGJ3?.BH?V9\,9A_)]7Ab9R4#E0V?8KJ[3aP6afJ
W(N(@=&6WgR(SO2(5RQL?;SZ&I>.V(,657]8<1_VA^()EbPF#UF8Cg[-VD@Me5P/
JJJcE&0#[VUf62OJ:(gW(;CS>bSBX2FZC_8)TbH,Y&T5_SFP&8@][+J;g7ROV^I:
RO]3&Qe;+E+DW_M9d(?3BT\7=546RAUec:YF19?0G>81&Jb^KeMJbeeJW62c(;\^
QZF5eJ+-\aeMNb+Q9(4&W2a57B:I1U)&05RGdH,#];aZ>&[[#,XQ,6c(JcSHJD]6
1\O@gZXeISGN-UTPbc7-[g26FPaIA,A>J5>B/682Fd:Q7W>VLeW>VAfN^4/.)MY4
]cWAdS[^SS=0eG4bA6;\1^#EQ->1@U9RWV(318O\UG[<Ne+3@D4:UMRVN&\#UFB#
?[6.-C^23E/afNea5SFID@II2U?10[LXd4?#I71;fZ/f,O_CN.321UgL,0TdfX\4
b&/54NPTSdB-V8/@F\VI.\L>G-8b5..NUX;.;6=D6RF<OM-Q&YLN#eY2K:Ddg;ED
L:)5SI?>Pf#TD>LVBA>JZVCdadA,/EA9N43^Lf:MLJ\g5QYO_T)M(LJ8V7O,R>F@
?1;AXLefHa<Tc9XU\GK^FLPd,T.QXAL79&F.+\AWfS2c1)PS(2FX)&_a@e0U9:1U
C?0J+KI5.QV;+dR1aO[8JI+&2.QKdDGCB_@NP:JVLg\JcT-4)LDL&4C>]=66NJJ3
ScQW9-4cf=6<g,_Le4IQ/?7US60]:N49a5HYfR_:fFg)#Hb07TQHaCZTCJK5HH[1
)YYOW..gD7)I9A0&Q[^L;I9FPBY3/B4Pg<e+4GeY4<G+^2IOe-WQ1_ZTO$
`endprotected

endmodule : USBDevice

`protected
@X:O&ILef([F8M,&aC:.fA[Q@NKWJR>)68PH]d=XA3ZYB;FEB6b;3)@Q5)[cG.4U
ZD/@]Y28Z?Y@@JHa5_:U9b+5]g<4/D]#d^f(?>Z8PRZI_ZU\V5+_,RI.ObQcVI-H
EHe]2C2=3QY0JcPaF;f6K]aDI_(BQW.E>JZ5.gaC.YYcLZSR@fFb2[Dc,R#W5ZX_
7bVXc<eWH/:AOJU#922S)g,@/Z]#?#<)G+W^aN9b;cZR/b_<Ab)TOHUW::8b)C)T
WA0YML(X,aJEUK.1XOG&\#b+ZWg,XA#aU#LPZQ2-#5cW)g8JD2<A\VKe@0:P599>
H[PD#__e)JG8I;DJbF;fSFQQ-&6V4;\dJId):6)_g4KX>=&OA::O8a9/?<5,6W[[
gSFPD^b9gP.UCB.--J?S^4H+>RP8Ec?HMegK/7,5J?CUHSdF(1JH;>?W65U9M@:W
/?OTfDP1#RB0[Zf-:885WPF35DS#;1,J3XHbcg?gUUJ@2A&,J;^[UZ4&dQ1G,^U\
ce\53K1DJP4dXLY=Y.,^+dC)#<QL:\9]N1[R[9?HXXF)/,Ee&B^V6;8fO;9b17e>
-QHb(Y+^V1W.F2^S(T/PPf(^:#BR-d9SSE:FAR9:dfdS^5).^@b#cL\PAfM^[(D6
cePa6E<1+53I[#K&\MS_/f[HIBEfY/(I6SH7.J#<T=:SA$
`endprotected


`protected
2G)JH+Ia6AL5/gOJ0VZSQ6@.=_b#^E#7>/a&[&f67W;8&TR;3gFF&)MX?=;I=gHb
BS7&I5/G-T&P]Qe+]\T1aQUUXa953ZcFPS=2AW@)@_cE6]Q9OXKUHe3+(4U&+FNL
&XN6WA\aVCC)3QY6N-<.K\CQ\HXZWETEOeGMU<V<J@eJU.T.b:6+F7I723@,I_GG
?4(51;_63\PMM>1OQ^+L)89T<V-427/X?0)MJRIU<.b<QcU67YH9#[M;8B6NGZ]S
(a[XXOb-afHWU4.Ua+eYNXE@J>PdaC:NN6Sb]_RBLYbWA_M6=Rf3Q,]U>(OP[eD4
G,#MYRNYd]C0(VU8&CJQE_G,.JM?.H;V_fV,SL;Uc?J[f]2)=1[CKMd?B4&8ZCVf
d:8-A?^8ADdRY8Y[VV/2K3]XfDHL^SdWVd]>;5@=U4f[E(,M8Oe<f#0ODD-;5C\V
[,OK3g(KS\[X)ETJ/<Rd,?NN28.cT_@f6(KMT&X&78TD1\b=D.9\-.\cQ#Z02A+N
9RDIKH>1TO,0>^W?_Tg-Z2TSE=5R,65Pe(=O#=1+(HgC_)Tf5S7^\#Q8X<8K8TPW
&+eASF[fIgJf7Q(/;g#,P<bN<Zg?e_D@@-]-/S5.]2]/@-)LcDWF]fE0dP86\?c_
_I)&=B\OeKc5MKO3Z+OR[L3IeK3YKB[R(eR8/=0MeUb]b\E7E68O7PJIJ<gC#YW2
6X26dN.TK]TPb305=gFJ.RC)c=A</5Q1J5K#[Z+8G7?D/.3V)NQ=ffb]3f,EF(?f
M4)<\N_\N+632N_g_<2Z(?1;8#L]Q.=D@$
`endprotected


`protected
LaXXZJ,A/&.K@5eIWBS4HBT=Y_9cB(+HGW?ZG9>:E2bIe)2d^A(Z6)U>HR0&b]JU
_>FU,H5?U(L3,THY/gHI5,ETH..e2ZLIN]91&@G5Kb:.BFEV<QHX=@Iec-D@2Q[C
3?Q+@\SdbJ2)R=6L,FV?4ZB)@(a7)QN<Y:L5eF+UA<KcBIX)R.b^a?^,#?#/&1Me
5RE6_3OAgEUD+)9]<bW#,@HT1,&4ULK4H;V1)BM>2M/dIGO29b&ZTL64+=cRL>_<
ARKQf,1Y0>709UJYbW\#RJe[HXE^B(c)IL1K,=5OLXcQWCLBNb=\IDCaDOW0:,;-
Z>(c4UL&?J,CUT9N\f3[Fe+W[E7b?+T3QE)>1VfX&_ZDDd>WKQW0DAFAbaQM[0\a
15aaFJ_VGIcbJ#NTdNBK@GTPc=@+^Uc053X;([4)GBEb35)g_W5Zc[d(b[7EKJJ,
S_^NS?fb3ePV/e1NNGEH[JGZ_;)F+\5_5N.W[-,IH_Me7TdJ[+)gJNEGf[ZcKcY?
e4VObFR0ZbegB5K/OKY.Z8A2ERDGV._TE-1b+K&OI\K_(g=3a]53SfT]FSA3\g^]
5#DSG/>D\fI<c:WEISdXB[b-d;1BUGU_-/;ZS1BaQ\LD8>W@L7gI+-_Q.)cKf-(d
&]Bc-DHV?DKKOZ9/FCH8A;LMC-gGQ7+\Q\R2a4K,8JOBbEHTW1X.Y#\];F8OSR:P
<W2TfQdFgNdTNJNKP&13SZN#bON7N=:.5bD_AeV7ZX5=:OD-[-PBH[dOb([^d_[@
?/;BCV2g48<.bJ[7FG/.J2?MAf,T.6G\[],Yc17IJ.21QR01>)WZ0YH>]UHT<FAO
=3SD8O345I\G5>:34TE;NY4U5AR((bI^E=E>,A[.-X5-.1]&LCMH5[Q7a3LZW.H5Q$
`endprotected


`protected
3:,VP;U12H0?S??U^QI0K<DG^Z+(?44TGJ][FLS=79HM^7X#fLN13)^L3:G,QB[H
Q1RL.T>R].OV6N.e?A0KV,fQ]>d,@Q(c1Dc?E_X@DGV+(aM5?/_5<^I1=8<Ef2+5
F3,I)bHcDZH,UReIa-L[N3GIFRSGW[,,#\c.B]09<ON)4bB)QbG;N_WXK8_^TP#_
MM_B.\_NE+VX+W]Te1WET6=B>26[f]7B\2W-M^<>R)MQ@;-Y?5G(/Gab(Y4B&4.;
S]D4>49;fg934+P>R7@Q,:GU^5VX78+cTLBLLA,ZI61-)ceYYb2/Q#SB\3B<K0@]
SY+a0Zc>ASWc,XW</\3#P?J]aNKF2<dTPYc04aQQ6NDZ;OTK?XQK,4>?2X1JIC-1
[XCEOHV^^^H7STX;AF)fJ?ACO1caEG;G#,L5@YZ:V)-X2+GO5HWb#<GPAI6=<.Te
7&O\3HA[HZ3bV>2VY]??DT_@B#N;U^N-/7#ZBY(F:A(#d98+N@#[g-aOV7L^.T>R
0UKbaS6N;^Ab5T-261LVUg75+(R45)+02^ZeS-FP^K>e:I@+g&),@I/0&A,81PF=
5c5#,SZ=A5&W/f.3Z/aQ/:9QKB\IW?;#:gH+c/QJ)fH&aIHY\cgLLYcQb&>VNX9]
T^52>^3=&EaS?B:S,/3Z]eQ+S_<#FQP^c3K+T//C=UcV0QU#L6V2IEOS//;22_?@
3(=D2&aS?VZB\Hg7_@LHg.U&\b)Ff011:8VC]VfcWVa41+:E26;agHKXeEEGOe#A
f@7;;S@3+CdF,:EN#f-;?CGQd_SWXaOAOG9P^3#8R?a4bP?@07H^_Nc/T^DV\ZYW
#=6#TBMb3_<F&VUCRH\YECfIL;?.2)bKPA=f11QTEJ2?00-#aaTP1#E@OWg[FO^^
3?1UFW@E9HEH.-R#D=BLX:HFVCd#J&eP@()-PJQX#G@W[\cQI^7I>M2E69=H+7Q?
KE588@M[MW@?P8G_W]g.)2X+4<D;^5+M5WSKHI_9/WI.5gP3P9J[X.),L_f(LZD#
W-c,VfD64/IE/d+A[\,]_^)fWIH(YDXHNEX;:e3RcF#egW/=+R1G8X),M$
`endprotected


`protected
NEW.I(2VA=ZK[@]6EV,+&D:d3JFCfW)9F;;WU?TJg^Q>-9g6?a[V1)?d3_,(aaG9
EK6;)WCJE920.2)[CaYP&E\V&13P[<FS-C+8<WIb8XKVDYMD7M(#feV]I,K;M]8P
HeD7dbSF^[NTa=,M]S.9bA]8g&4f8=_Z45Xa9PD;:#?:DQ38\00:7,IL5M+bN[>&
W(\9,E83FMZU@b?,WcFDI):3/9AeRK.2?bJTT<AHB\?IcW^6DD/^OO8c0P8)^c,g
=UZ^LNDe9QL8RgNXWB4\HL=O(Feg+9-DgN9]U_8KLRWBHP0HTS[,6bPOT--#XU3[
;JV-?6MU/A.\b-e+WS+M]bXIT4\V/O][2^3)0GM<&##cLB5#faLD?PbHP/-G,6.C
d<\\29fBH/&]/M>9&PQY?.3fKAWT<&cDJ0/MSDQ63>CaJETOW)7Q&FaBg&J-U3Fg
ND^41WK.@;Z](\>;IJ@]@N0F4QaeS)Bd/dYcZ:YTP&;Y9M/JP]#6RSI/=:8:+<GH
;]G@SQ#S_\a(>E83]f:<0LdV[UF.GTc96KL2K9c@3MBZ=0<(<04fEWT/+L1YJ+U:
EK^1a)bUKH?DE3c_&WZQ/RVcM:K-/I0P(\,KH+f45_Oa1+cA2dZ[Gc.@JM_JO&YK
AI(CB1fV/8W;f/Vf/00N]6>f>S6#JPY[3\F@33f?E94H-#N#,(?T@42.6c5R8c4a
MR@1\=fcJ@e<bZgBYb95P2[=N1@?R??OCJ6ePFP<3,^MHZa;7B\XNJ1ZQ]6,e5#a
JE&]G/UY9_,=WG,>Wgc@4N[H&\S@,[;b7X7D^8,GU0U35aZWP-=+?_X1NDD?FKT>
e)3;g>]0?E2EMKb2I@:-Q)daUKJADDYAIBYe)7[d3ea#O#4<daN1gO2d9=\7cF[5
f=N5\JX-c[C;GT4c476-=VIVDP^=4=+33fgaCLIW;cSY(>X>M.fC9Xcb1aCae:S(
.,R<LQae3YT0Y<,U&\KAd^YOK[NRL:dJSLKE=WKTEHRS0M,PfV-]2\CLFe/Yga0WQ$
`endprotected


`protected
H8b(KC3B#Lb,Y8BW3[7;JaPV3WVTB^?+FZ6.,Z/N.+TA_2?#:g43,)eXR<XggOPO
&G4;a01.O3&2b:Q7JXW8FNf^_C.=fQ;Yb1/eeCP/HR2UFI0e+b<c<00#;T/QNS9?
96[HY&(adW?L&J_a9]QOZ[K\ED?4HOR@fW/H,;8#8f3N/b/c/OH;N)(3WSR\dTaK
=eZ\<KMKb_5aJ^bX^(CH-KaYQ;g+\<)gag_R+&.M0aZ4>EcIW&2VdX/Ga]0Re+I7
e#=eSf.Rg9V^,+fgP>&^R2FYCRg^?;c,)--aCbCYE[L/^-JV#VffRE#0[EIA?V(@
LTKRe.P#ONXVPU+;3ID?Nc=3Q>JYMR9D[53d4KM(M)QfbWH:XG6_S[#7^:(OQeH&
,GNf2OI3[M)\dfHG[IbC[M/RZZ5RA1T15?e,[4bWO_L]-5QYJ]Tb?L/A13MHTD4-
S\R_F85O>81C\b\I]e;YT56D)\DDD)-Y=Fd123>3+W<)Q>(JOI0Q.2=b:.T[-.@=
BgUV017,1e<FYN/VDXVIc6H8;[S3+#L:SWS2fM/5e)YE\#)JEESf.>WUeN#NQ-LU
FFHK+.)F]ZYfL?Ug7eRDe+P63g@9F]QM3QXTKPM3W6P;g\c+U,KbH?NFaOHRT@26
^O44dNgSRdYGLaQ[:e,b\N?T_)OF939cEID-VO&CZHQJGVGb:B<bAc4.A;NK50)F
VV42]OB[^UPg5I])cUMW@(B1#]/VKM>+=.D3_9,[_X#;[#:&BbWc\HL==Ff+N18R
Z59<PF/=VbaL-gCPgW^^aQLP<\7X<EUQ<OC&bJGfe#P/4>5V+b77/@VLYDDS&V<3
g,;FN8([W01C\>^F^;^Bdfa/;>fXV@ZH,-f-S]bgCZXF&7MLRC:^fe(85<_Q:4ZU
E-:e5TVcdPOfHY=G,(35U7\U;.(PQG4]fURE:ME;-gL4b2U_+P6F^U4DVCT]U;&2
fT8[UPTC>KK27-f>?KOAYbc]XQO?(6]Y8gb-<Af\0\]J-S>X->0W7NT9f1V\LJ5&
CF;?f45KL9ZLTa^SL@N;<@#77F\KWKH9;)8K+e168MbH&]H&OabgA-fc]ATSggLV
V=VO;7Z;X<BeW\>Bd5>PK.Y2H,TCK69N?@b90U:8=EPNI9?C3E)e,a:)LNES4I<0
SeZ6SbeI109F60ZVO4N-Q:2L\9gOUXKbKH^@@O<1ET#c[f^F<YcL4H>Ha8d)5KWD
+d,>,IOUE]Q.TV.S+,Q;-b^;5]KP(.,#FP1>dbC8H1cfUCBC;_J6<.1/M6XAMfFR
]a[-g#<V0/V/,\\,S<IIOKf0>^8E#a96;JM1B?g;?b8^B;^?#O+E2+[e=>0d@aZB
H/-(4E8A(,+[FcWfPVdB0&LDY30fD0T?AWCW/[6)VZ1H1P)RW])Cd((_1M>MfXSJ
5)TDAJ(^F[a<S(=_RbC+>Le:fLKW6#bY6IBD-cB464cM[GHTL6&Be];ZA,?ZZHLI
IKWVF/4bHeOTL\>)^bL9N/d3W92A<2SC79A5(ZJ.<L-DP1dZ.,LOA_BOZgRY?Q^Y
EXG:WCB])N^:[K&&O3BN?V4-^.5Cg#;IC6&P@VO6>261.<O(3_a<MIdE,Fe(Z9VE
f[;Z2/Sg4N+].<ANI25QO^<G_;22)e-=g3:3?/KP19e6--f,M:P0SW.3+N@;e_f)
/Fc,1ZLQ1:6\&\:DPa]I8,_=V1/Z<Y_/;U(OeY+,4OZLX7)<58QdEL\(EJD68+@@
C2>SZ&979(Kf3QLMTddf-e#QNZE,+K:bFAONN,;7\g\gQ>-4./c?Y,TEG=@R?3cH
WgXfa,1=A&,9P,.2A[@>.CB:I03edDN5E+c5QMLBe4E(YI))AF?XY8T@]-7=8[=M
C@;#UXN\KDR>C\53Y+FI[H[\SD#Ma+ObR]SZTPC0/6)e<K@4)3QXRG1bH>Xe=JVL
L6@KI2?I\(J;+XGL];331BG1g]-@F(IO_b&GSFE>G,1DP)0KML+RZG.;DI,Z&KgO
]OHKZ:S<\C6UZN2Kb-@YA#/,NJ\3=:?UT52\YTG9#SEOAdMOS-?K[6[aF2CDUA82
4>HdBG7a<LG]#dC3:J;DQ8V@P50_DK66-PB0J2U^M^;7.EZ3/]>BL:,-5,&.A1>Q
_T:E)d6M?+)cU@CHE?JgZ\M4A?L]A61REMV+?:_R3=\H8XbCc?Cf1c(,(5:fHJ:G
(Ca2^_(g0WXf#0S_FRL1bf?^@Eb74T&JfO?RT2)FB394504?#2;ddL=KP(>9aCD(
9.[#CG<6GK2NFA1:fUbGbH6\U+N&]C:L0\N21Fd.W)V<_]LNTM#]8&#(O#G18GG3
@bU#Y?.gK:>^e95/#ZO0X?f]C3GH^UY^U^DYb03L_MeEZ@]Nd(V^=,93.g)L#Y\4
a>U&PH<8N/QbfTeN/O&?X23IVTD/VAE9E1;D\?5N@?_g(B<>HAa._Pd,EE03WU7B
NU\;HgTHg4fJVe18O29F[\gWUZNN4aFNR\gb?J,de@\^H8YBf>L<9=:\dY1)gBW6
F[a\e:4D7,NX+@>ASLE26\Y_)-_\2XdJ[+P\7WL\R?#A8-/6EA/]7cg7>C552]2:
PI1.A[</VVO)BSBH0PS:AQ1#V3_G49/#BT?WR4NZ8YTa,LI)+E:>;379NY\[P\M[
2J=BHF.b/3U)<eW,0R]DN5@.F3Y^]_7cY7baDK2_P7D4L3VB8]XE9(1R89,@^X5a
1L:TR_KV/#e4,6D@5&Xb7I/FH-@&>^\2^<(KRP/1(;>],M2_95=Bc-+6&#)48AV>
_^B]fCVDZ3)41b_Q2>16eMU;Z^a09\<H\48T.4=cQ3.HQ.5>.]-[\O#4XY3O0_2+
46F(US4OfTXLEcI9_,[7:?-;7/F,24[/DcOQLA\M[IHL(Vg?40g9W@?#KD+[2Y5J
ND-8)E-8e7WKGFKdUWMG?@,g,ICV8ODa(a&a]O_]R#[SFJ4Xc_G)Va(T+M=\M=C6
2<6g1EAU:J@bD-a@<]N]\,eabe3/#&3)N->=J#5KeO@<[g7=0KD@&>&QG]J((NO0
NJZD=0.KYW?=(U)8gTIFWBg9dcWZfDf83b85QNW4:,0-X9XC_MT/DC_TE&RC@cQc
7R7HeY?:cNGV#=9^-:L&aM&BSDLg0d#GQWa8\b73/7WLB=XB&#bDY7Hgd#]T&Me?
TN30ZRU@a#IaHZH#/12dcggcSK/N.:.4GP3R<X\^;TI0f^D_:G4IL6U)?U>Jf/9C
3;\[YgM232I&_D^#7XA+M5KC/>#LWcV<AHB97LN.]KSTW[Vf.V?Z/FB;8Y(a-AI1
@P[&+?eD4U6VAH,+IbGX4eID__XQYL]R18M#:H,MZ<g<4Zb?MQU,T_a2_8D9?,6V
@SCFZa\HKS8EJL+^333:KS.J9LCP.I:.<:M.cCeG#+J6=PNINPLHK0##F#KG?2KE
,1)a,L/WK-]WHd:OE<K\b-E^a1J5F/T1,XKb,PS=dYF)e<1E0^?db2c[M&A7HDBY
(J?/RJ^9<B^2&2TGYfU7Q()CUf4=8^fKKVb6[a3(002FT2da:3Z,KeJ7f.Q>^d26
1f8P8.E:AfX\QbY(4S5EdTCAgS(698849R2+K.@BDJ>_FBRUX@Z3^FgKY&fUa[O\
a\UC9Hf:OfO]2?a1KA<-RB4<F2=c;3E@D7&GCC=@N>QU9.&3I7P?DX_01[4,=KTM
IX##Rd_D5f<fe&GQ9J;OS#Tc>+8E.8W<&HQ^FYUI/fOIVbFf@8ROaWL1&(YOGBa?
GAB?B=LGZ&CBP+Ie0N-KBF:_>-&RNW>_FVS303S5\FKaTZ\^^R+UX[[\-+GN)E[P
]e1DT27>J,A^C,8ED:O)=ddKU\2OLG:?ef5N0D3&5fc&c:]a\#IGRYT#]\N]f[L_
PaIY;:OSD=#N3/=_=d/H@3LL+/g2]__dO5MP/HgH4)YR@CB8MdEU)\4TEg5[NN^?
H+GeUa?,7gAaZ>C0MYHc93]\YO5dKfON/PgG3,+@bZ>c;>FGH#0LRQB0DZ_KB9>O
#.>T&1.YK_9d)^f5E)0=4V4(YaZ+QXUNKM^eXM=^M5Q^03ANQ;b#VY=P(^,(3Y6X
V=1#NP2FgM0F\T.d0H_gbJWGG#c[R[Wd8;2T,5^Pe0TaQLd<]IgP]E9F:RY/1B4F
d;^?2@&_f=WA3<f@Q>cRQ97b,>K2U;cL^Y34cU[435192QK+IJXY?7UEb8Vb.W(C
;@]8ERZ>aD,;OPNFMR\4HF&2XPUELA\_HLa2NE3N>O/IZVcb)S4,=SC/T#_PUOL1
0.#9,?Q9XLVBO73Y#2b0Ig.eL/8H<VWOXJWI99RE\QJ,&63X&T3/XAS@[@+4/I,[
_3<gWKA<ScO6+/;7B(5HWK6/B\Rf=/1R\gB.E8XAPOaJeGB=X/K19<LOLUO<AbM5
XQ)[CSR2Tf<.58N@6684JE(J:AgYSJO>4;9Q+Ta9fPV6](APZD1.]F^d40CCZQ,+
dQ7Y2b0-.-^^5EdP8-5465OW7)gLFJPR&Rf7O^gg-Z=6L5)^.QOG,0Aa[a^E:ZE[
A/)#,7VK6)W;B3[Qg5?cg29g;82eVN6<;?<,AT]7O62N8_=QY)Z.S@=6_P&7JVT(
^c>,a^WU>_@2:eCT?7[3;Hb\QB-HI(M=)264X31+#<K0[f?<^)f+I>0MW6Ib(_HM
G&X?@E_.4U.E8H@;=[)-[6Z/,LXR7Pb\[:g;7?a:G=.1P&RKKgG()I4eJf&]+eO#
P<1.&:638I-,Pe]?)+a7@IgeA?bKM?BEe8>6>2M5Gfg&(9ce_@?SCH164>+_;0YV
W9L?^Q9E].,?/XBfbB9E+-)8^L#U2(aYM\bAAa/cY&016:Qf/GF&)([J)PKc(c=4
^M;5??S2]Mb58DSJ-aQ5SAeZT?MCd@IEEB4L,#LYIE#(83B/]g7WF?3YYC(6U#D,
.Z>&.@#cb:4UUOZ_+5>.ebeTXG6H=(c+U</KJC&:)GF./Z-M@3aSI2gPMG[V7U)7
7\Dc&b6H1SP7-2De21A:6a>\ec^Kg?7B@d3H9KY+E38I[+SE<W7SL2#\YMdc1I>^
B<7NLf;E;D-B;O5(d<6f+c]c9FD7>^N+-TW>.\2E=EX<CeWb+fIOf@Bd+ffYS@3I
2J)gCGYL>[Ye<gbHYZ#_K#N;C.S+MV&\PF./(D&AHVC#Mc#;7LBMHDBQ6BfQe,gI
FMT3LC5GI>WZ>0IJf?)c_E-);<N?;/R[L=V2F/_.39c8WPY&M?)FH)Se.aW#SVHc
Z?5/CXW918A^-T8CH6S20\1G3N^A56#dDYLZ(BX^46>>a[AcM(6N^ECcdS8P-/EV
AQX.<b_6Y05g7+cI^=]3NbE0@g7GKF/&JJ[c^Ia-:V?A;fHN=D^;-C2->FdK<fD]
dbATLJWUFI_]]R6\WBa36Jd>gLQdMff_-U\ERNSf]W></K4WHH-Q-K41gY_&O4f]
]]bX#>/dP4(7XYPKKD^c7I-7?/A8I>ZAAa86>@75eG>g8d2)@@QX>-g7X?0CKEae
\4YYWIP7J.;.DN=(VJ4JNFX0g10+_)O^@F_YFUZQ8([@GW_?NL?F[^9#ZR0fH.U,
ZWVef_X.E2I@:,G<:V-D3G3IE^T&Ra(BAJHY#PfEL7B,[\;4J4dX6OPR1/<:2](\
J_c2^d>8/<AO0GO4T?Od)K-AaLBZ[XcRVWIY,VGV>dS:KPEeXDf=UI#R<R?K36gX
fLMDcVd\GESFN^FL1E>1GCL1LV.DBL[>+LTc(1T)YI]K[)@=Fd_9JGdF_0S&4Y]W
Sg/2@GbO8>B)KH0N?fcFB:e=F.+:F@I&G.WBF8AK2bW?1ZVcI/5=+^He_/-V9A)-
GZ.[aGgQc[K:de15BLB2aFHJ48DWT)cO[N/Z.[T1g4(;W/Vb+85.bYTDY3J+#PC.
U&+>PRg:WH_2P&BXE0A9e)MRN#7.a^6LS&++7\8ca>bYeOGP(J+f,_IbFg5+#UN<
;;C??H)YIH<,03#^ZA4M),=/@0Qa0?g2:48IF+\HA7:-<-^SG8GKa3cc=KK[Y<__
FR&T+)Ja<Z^1>;NW+UAe6W:fV+,QRFEd4^f,C@JDED\810#4<O2\<7SP72LH<:UU
PV\RLS&@+Z?7g/O,RX>DM9e<KL1J[K.]?\bU[<;P)TXRd)De,?TQ4C<A6JeL/b29
+EW(VG,d=4/D@LF1#73&-\@SJ;8D:NDUOK/P26JB+TD1=b/Z>J\UULMNA:6Xg2#T
LKg-6YZ-72cc45BUYDPI:c+R]LW[^.L?2#)?9c8U@bSf>KI;X/G0Wd#.L.[Y;P]U
X\g16D0TeTXA#)GeUXNQT0;Z_PY=3[A@W+f&8;:9-[BcAf[H2PXN2b7L[DQ4,_CP
F@[>b^?A^DW4J(C\A[Lb_EQ+eGBUdE(:.8-TaKf/&IKEF@SK+<W6Z5>DPW[.)&7A
5&6[;KBfg1aX_D[341MQMa#;cZ6]<eHLN3?5#HQ_(O\Y(<&AdO5bH;=X.9PO9@/2
GH;#f<,@?4eQK58(VGP[?O#NORa=f_;D2E=)RDCJdZ46IN],GOaDJ-^1[)fH;dU3
1N8O0<CXc(]:fbP+d)c8cW4@@a[H,V?eNBL(UF8MX;5eaT#O<D.]-.Y+:[M.H&1D
UDKWOGGHE8IH+IS7B40LeYF,B3beaV_=T&:X=TA(>F+9Y8&NOc_U+4^HMV]PWCR7
+=8A1C\LeH,D#O:XAG=OJ(BF=@^2S^9a^1CW(@d.,;4C0&<Eb^UN9=5(b=AF2bB[
ZGF^#J@d4XT#SgX/a]KQA@VN9cK@3c2EM]fI-Na[fQ6,BOBO31E.=G.]c3J3-S6e
MbGQ9c-/TNZN#+;CZ.^eeEI>5@ePf3.XY9O?=XE^\d;]TDEGOX]LHDQ^#Z^;36/L
)#ID;7:RH\_FOALLY2XE(fB2_?.dQ-0V7;@X]H(87PH(5T[\>3<82@Pe06G#>/>Q
P2f=-dH8DZVI0bR2aI.g:/AI?3FIf3ZZ\+c9a48.T#NI+#LC\MRY[>V;/2ADINWH
F<5IY9X>T-+O]C2>=06,V[0BWUN37._^X7e]YGJAF+#cTVH49^]/B<DWNC&0;4AN
5=Hf+@4(F4GV?T;C2DG7TR(W6cN[L[?#Y>KW@d=&/OEHAVATS4]8^>NWFB62QeFD
AQ^_>@\]QS[3DG@.9TI1P;cQ.?;SIC06-)daJ]@,Ag2>_JGdM@1cU;&0f9F<eSFZ
d3@cDS?FWg5_eXR),N=0d>:#ZMYg925^a-.c:1UA/gD9CBYZJJ;=&1#3?(00N3S(
1VH<V[@(J<2Y0<?D^#>bJO@EI=f;cUF]AZF-CGMWI/6.H;LQ+YK>-I@KW&V.79;S
PaNH-QT9G?E1OU+QH1&b#T:&;Gg3+LQ\E(JU@3gAb[#//+D,H_3(1#FcOFc3d\bP
X>A7)K](-fIUC.Oc64.45_NWQ/+2F?;53L(_A^UP:6e]]<?[+(1W#0-RH(<N[Tb_
4R#WO-Y[TH5M<+C-gZb^,6)3B8A<29)#;Lcb2RA_MU@O2&0[J[?8e>>c?-D.N)<3
PH7_#b<K._0C1&YeJ6;:f0M1>FU3?a:,?W]O,37fYBIgO4-_+U&_Q12H@W00\;3,
I_+JID6<Ib/E?[S8>YP+I?&g_56#J28>_&JX7[;,IDV-C]4;3R^bSX&M.B,:V>Yg
&dS^3]B^CF:8#[CZD&DCefBNd/=TMa-:(K2<&Z+UOKA(EQ>Q@_^[RHR[-_.d<EG?
4a?W=LR7>F]/B-/_9cT6JLCa.Z:5</Y2+]T75SB+<F920]KOIFXT]T8WNCH;5IXK
MJG+E1GG>(YG]W+84Qb1/NDLDc)1;/5O\^L#JL)2VL<:#&C-7fQHF4DgaKJU>,/G
+=E?MeGbDOee&feT\dF.R[?:GT53G83aZK^9IXJ@5QM0_B@c76D2We6cfG8OP52P
4_05XL?EI53bZEXbS>T23@S\X-gA@c,WH?d;#MA[Pd_(=7#G4b]&4c6?R@H>LR8E
EOC<_D[I==_8HYW3C7SfMX@fIf=4F#<#<YE]cgSSXV1:0(C@Q>I@KIS0^PWYe)0W
#ZZV1Y49bR/_D9+TOJeR<,.ZZ7^B;]NRI9]e9SGe-&S:C1?d]5I^e_;T9>I+SegV
0F5Z[8U\/;=S#7AT^CK?T&RVLSLVNVU2g3XX6@CXcKPJH8):S9]c>-BSe)>2a#0Y
SQ[IDJXQ/S\;UG[9K726K]@C7&508&G7GgKNeIFF08O@>#J&+0MGNK?D>QgF88ZT
4g]2Qa69E+7,DHG65FaH7U5K23?95U;3)&DH:^UgeVY=/e01^^67[683:]eL>XT7
CH1J^<:#N2&=(=ES8YI>/[GT/?dKeVVBZ\+c6bLM4:8A4D&ZEP6WO<_^\+D8Q@e7
V]X:T5ISGXC/7;3CgR2KScDEfHX>b83I.7&9P?&E7bR_gCUZQOAG:Qec&+U^gLU3
XE2&28(Pg7LRB1dRE?M8\.S.DT<9KFS4\[=&3@4W8_Td>FE).+9YR;?9-GJLg]5)
(gBLR;<&8B/.7fQX^/D5A0MCU)5N2-N0Q^,W=.V#CL\;@FAF8?R>V;JQK<+KbbR<
Z_B?&B0_Vd--)K#GB,HYd)LJOc[DTO\8;]Te3P^gK.7M61X=RGH[F/(L?+/^F.\.
e]L8\g^4=/1gF@d8\,)?UBW7ZOa^6\TFN@]\fN8U,4)c/3F8cU\JE]YG7RX1_/VI
1PBfOfPU,P\0D>NLQY_NMEI+.3DgA1M^?1gA=+@4GRRa=4/SY&,N6Y;X7X/W]C^B
H3=[Dd(#T:B&ZCH+UD[6S(^U4^+#;OEQ^47PMF5EG6QGC&WdCd6bcYQTE=d&_S:.
TMT5J,9PN+_91A\2E(>4SZ^U6$
`endprotected


`protected
47Q7ZQd]gQ&aI1Y)RWZe1=L2OR._?&S\FZgL4YN4R@)G2+/X[_5U+)0F2;^9d83]
W>1#QRbMg;KV(^+],U\U87=eXJ([M?L&9?VL)@:ZXR7GB^VOa@84WT=2?Wf+(4@Z
MJYg4&M+T+Af2.0c@d?UHd5gg@,gPa->@Vg8fWaJR_Y01eRaUaPd0XZ])L9[-0XW
#TeK=559Q-8\#c(G-J9bR3XU_M9cJ.WND+Daa@6T./V?/9a6#9LY8ce+(TFA-0F5
Z7IW_PJ1TD^X(-TRBZC-Q_O7:1>fNI5M0&]=AL#@2.2.DW:SW;F3=fT8EdA<<gZb
^2fE-Of0354-144Vb9(;Za)Z__KeTd?Z>fJ;I7Q=?^^O2\:0PceRVS?E[J.S.^.O
68-M#(V]ZH)KNW1=d2dYa[RG(JJEW2gDIHQUR9_SbV,g2a,]FM7P@Ig7MZ?GPgC5
3(a,DC^.19;.X(_;?22C;&-QH3^PcT=M6DR4Ua39/+:7b(J6AgfQ0X<17d_K<37S
IT8c:Md88(0Ed>8gZ:>1JHg+88aCe+0S.MYL/H&PY:9Ca?>#EU5UP0eL9AVbR5cO
V>3T\K.G7gS028abOG_-#YU<BQ3VUL7f+H4+.MYBE,BXA/4UC]IHB>GQ>7-I52/M
_N9^9D1=L^d;P5-3OHX0/L#=<Qe5&]]G@E_#?QP9#68&=GFKf;L?9Bb3TS)=UAJ2
56]Q35D2N^gZTD#6.aXJR(/+VSGG-IYf;3,Mf<59A5>?SQ#S^0R90Y&T;-1ED\,Z
-f&:EWQRXQHIO^b=^DHBN[?8@/K&T,dUO^U>&^fPD\RRYNGQ-[aRW=fe.bJTGGUb
GKaC31gEHQX3-]ca;T-&[8V?FHQ-@A9W8a\P:ZZRNJ0H-H0c1<S9&SgX6WPVf7Df
\4WCZF[MdN(Za:/.).I68.^.7:,+U&XZOSHN^+>cO]H;.7DR9CV88JE>+Ae,8IT+
,@b52)^+a@9DX+5J#XY(XaIQdFT]:VT-E5/WY>L#;+FD?K3G7G)+DHKQU>6VSYgB
SJ1ZN[f#C[MF57^U>NYE+VgN)@XE&3&45cS(ONddQKI1edb&7=59_O4,M>N8K1&9
CcXd@LJg-.3P^^/APG=K7+8_=F:@4)/M[Z+XYg09W+Y\M=]+JbN++F.@ePER@T^R
3-8a^4&OMe@?YO\]54c++#2]_DBX5+G_7/HP(_[^fHQda18BS.^,-Ucf<4JV0/2C
Ag@R2H6FFVAY7@c.OfR3N;3@>[E88D2K6&P=#6=CG=PX:;(M?1O)bN4)>gaT#W/R
B:PE>U])/5:Gf_WG(?PT;B&CKeLG8FN.9==9YA7S7B(@Zf+6IP[VZ^HJdTM,+Z-F
5B5&_X;Z:2J>,HL:,UbL9\RN5(6f1(,)Q[UYbQODE<?S@FHd2@Ha8.K9TFdFJd\S
9KVFN+JXQ[Z1b9YNY8)D[E,BUG33O#[FAWK)a?b94WLb-N,Lg#D]_IR,[e<?P391
ZI_gfOITMg#/U8G5I2a7+\L><&+#B.4=-eK4GO[N3E2[DL^H)#K3\G1PZA>L8aX5
>F62g>1V:Y>+aP7f;DLKPPYHDcZ];)dP1E0OSOT1W)):U\3@Q8Q03D#93?HSH:OZ
/3+<]-Ee/&)eJ+U,Y=I)XLR.b;\EW6H/(1d;eFOB<d7KE14)[)7dgH;b9.?6/Re5
fH_0IK\)&JP56>,^c1Yd-621gO<bMbe+bPB_P=5:F-?])f/?Q;]cM5g)+W@>@.H^
A4E/8OdIR2#8.HEGTZ.@VEFQcP[?CS<G]>C+T\;MP)/T/1U,4#=K8G/eW#Q9UDM&
<\WVA=1(+5Z:QG56?dT/EXBN(JRR<0D5FbUYea5Tb3(^g\+TF<,_<[4)SdD8L)YE
g3B2TfK>_C0#O-XgED.?AZE8#;QgZF/1>FaP[ZTAA7;c:PV9JC;/\:A-1MY@;C/3
KN<PNg:@gPPZ<(S;+AfGUOg=YTV^?0&-DHcD#8E,&<UK0\)2V)V4H0QaCH(/)H,f
E9N>M(TI2LXE^gJ[dS)_788^S:+&:Q<bAUdI/T:6H5)A&3_ILY-WQW]]e34)R^,P
g]R)de0^PV[08cEL)[K/5G2=dXF4/SRZOee7L^Ib\IZ)2<@(7cH>+V_O0UO316E,
F<93/^B.<6^0^VJ(UD8GC(b>]0gc1FDV5^0/F3\ePDNWScF8WRJ0Td.DQNVK6SNB
-.+T>;QWI7W)63:V364Y0T(dAFUQ+4_TU72B/7X1P<Y?<&89>RJM6?2fT=NN8.D#
2?E.9d/CZTHU6@2RLUY,6-BcfO)I<+HKfNQ8@J;cba(Mf@.Pd>>fW5=ZaD>eUH0R
#LH>BLBJ[BNe<5;3>)/fKfOK)+(6P=a[CB7AK&EP.ASE5NB:3Q,9>SD@3RPQQZ]b
<aB:^5W)_UY,EdVW5GR:>^Y/dC\g/a5N2>F-:6CDL\5JH=PZ0cIQF6]IN\3:_;@d
M/_2BYGXO]BMIAJ3#37I>AJZ[a5I(S17BCK7>@D::E?5bFK3/XOU?W;;?\RaH4\.
N5.46SG=I7Ce5#8ARNCT&c@><f3S^<?J9Y#Zb_RV[BO7c,X&+?[1H2THMPQY+QZZ
/[feA,4g+2d().Q&2Y-RIQH<U6#@RA^&2S[ME<?W>C1+O?bELJ.CQV75QU2+\c2E
VQ2/(.K:NIQZ7>&+V]RMV1GSVLDgE(GVA0@a5098MRP2bCTe6O4W8+:>V/3W7/I=
)Y#TA_+U^@4<+U@):dU+V]--RT?\a&gC7&:.15\[UF][f;04EODW<e@@69PSZ71+
e&H#A;U<1M1GD)@KaG7BH6g=HBf#>NZMA1AC?\+Z#RQ\Hf<S>f\]&AWZ&?9Va;Qg
eF/8C6OR6&@O,,E3\IZIUAS/I6c-^J<KdNRW\T:(AD3:bEM0(=;5QA6+UNKa?N)(
,Gb^QgX/JR5APTDb<W7@GG<_]<.eOgb1?_+(e<f;b)O<7/A-/K_GZG>8eaQ^ON?H
ZT9Ge/D^1J(Mf&AQIUO#f=J#8gC#XGOX1[1J\+CWe5G]7Gc\4<Ob2^FK(+QH6LA2
DHI&[+Tg[Pc=74?X,G5>BPY?J@e-]9=.#\D5#RJ&V92^-218S1AcHLQ1Z;QN.ME5
)\(7>(KED\aE-gCTKH?10N+^YYJ59OS963f\Q9KD;3.A<EFS1Hc6D2X;H,<M.GGT
QV33E3N_b3V/W&\KZ3_TAX2?6c&HAGY3H7EPD2eJE-ROTHg#2[W>5:A9/>W/95I^
7E.Ye^M)XaM+_6DUeJ]BeY<4fO8QDQ\Y-52[87P7?1VEfCgMM,QLgcb-JVULN=Oc
#AT@<gdgH)QYUJ5,Z=^5U.:VD(R?&>+_=@EH_QELcFN261+7GF(DG[#R;HW+@IA8
+FD-WaM6cH+HAQ:cc-b?&gX)V<,>;9a^+=RYd);ZgL6\I&IE8OYXaCB3aOMg#:1;
OE5#^&dS>?f>2XW(:,)c2MQb4S8HcJd7978W:HZ@11^b^cbgPUfJOX,89Ee-@0;N
+;.(?fJS\\;]VcEOGdG^7Ic-Q>&PaJ@(;G:^bXL=bC;0f&YFRZ/;=^F^]E:cNG-8
A?#8:WE(FT#[^fKGJ/XU7>1(^JR:[119R8CBM7e2Q6ceW3RJ0@9.4F;B]1>SbfG2
Ca-AA:T8gRS38,_IT\VFM\[<)5B/DM[PM9d?]QK4;fCG^V6?=E];)bN.S_KCI9[3
.cB[4T:=7_@KCY)=fe4@#VfS8JdAM_/SMI4@XZXWFZbb3.2bTZ;1OPM+--b+6@B9
F-\a]I;e?6)V^T961<K;R6XK7bP\1YC#8==3.[W.2745B09-dMB5[F.d)>(;J<D0
E0fI>6f\KRYA&5ITcaLJ&[NPBGQ83F2eO8\0JZWae6_4&04.f=SB^PW_W2_7\^PF
84&0Q3CVVW#eYcb-J+0_;AFU\R8XYGYVgU).geHd#>a)PQO4f82<6,ggOZ2g\3>H
RfBOEM/1T^e&K^=]@Se=RDfW_H<V,GVg<C05->1QeRa]#+.7aEACXDgIUG8He/=P
#VAbP>F7OG6WFT>U\0?IbT[4U-GMMb5O,,-]775R981e^4FTO.UGM[/:JYcA+]RP
UC:]b..GVNBW&7_(;55JK(H5MacAK[>(..0M>0VZ.X+f:G]GEe[bO(:GMTF[=_/_
QZfONU).CRAP@A-7CF.e4BLdI\NScC4B_cBPcK@dORf,:)b>6-@27;gL\.<gc)M2
XDZWTHED>-G)]@H-(H<NYW&RK])S/7+UDb9B++5MbAE\-=T+=9=&31bQ4&<UD@#4
d5eT@-Df8:,&fA1B_K6]-cI6I[9SdMI/;XVD1^A>_BJaPQOe0>c,36e#EZ\(aC/O
SWHAKf(W,HB+ef6caG(]05R/,4NRf[9R.5^:dNc4/Q<QB9g144C8fB2Dg7e6]d;M
)NR8JM[\W/W7X:6:..3O?^bbPa+H(U4/\-Pa-?JXR(JM8f73M)b-&5)QF/b^VI5d
WHbEHf0(O1-Q1R/RecV^(XHe[d9-8(XL\X](;.MHf]7d_UaPb<#((2A5.MacK9VT
2)I;RYNV/:+>?f)HWH9&^JD(;J37=A:cLK/:NB\G)5H6^T:9)+X<_IHAf8;9D/1F
QD]XS,R?:8#S=?LX,45H8JfBO(OD;3@Fb3-LC])E<B;D4ZQFWJ.&P@g5D5&E)#E<
4NTJR:YD[3#88KOBVY<\6+./K=F:K7WS=cC?4]C=AA#[C-^<&C7&:8=RW=#IA@Y]
AQYHO;#UX;X^5^GVM:1A\\eaB[_OEQQ=>04[g?(^_U1V47F14.(Ac?/[ce:>YTQV
UAE-9QVMZY];C5IU.L]ga^OD7<KT0-eK[CH73+LW[:W^&G(Z2&P?1=fNSHZ7dT_=
65^H,b>6EJ0YfU<ZKYY#06]]gN2K+@#RaXPJ828M[.UccR2.EW>H2E[N-R9#=^0O
(WB[c04CO)?J2QRVA[L&PcdT^&U;)a@]T28A7-Y(g4gT.^7\FQ\)[Z<>J]d@T_^Q
[5We]]RZ&NB;TYfX#W_+eC^6[04g/?P&Bb?0N&1fAJO>_;MdGedC12eS>Sb.1)DJ
eU18V0FT7_LBJ5?3?OK13fOOf,/F[PN@XHbgB91&[<LJNgSYUbE,QE[^J[LCNf^_
PLM4B[9104_Z.HG^U+17gc0.e[cCQ:eIX;S+.\NT4E1&J#,CQP5e2<8=\ZGA<_Zf
,55?;(X8A>_,3;eS4O+()#(GQJ@d471:FRd#QHULd6/de@S(C:W<6f:gT61LQf,-
g(243G7O+6eS?RbU/7=e_20FgSKW</87(eW;4,QO>/egI/(-W6DHQe+?\J6G:#4P
;SF^;[HNBU-)&]IHFW9-Eg<Z0=4G&[YBG2IBONaO&2.C&g4G]#;B,O(-[3+4f0X^
eTc=V:PGcM=DU>NL&\REW=>M],=F34:17aK4B,-S8_DM@KL(>ROX@O;-FTWe>Q](
HBA34MR,4H(D8g7fK&NE4593O=IJ&TB]Q^A\OWQXIWWe-1OO0bW5adF(KXJSU4gN
e1@FR2IIdUR#-g[D&J,:JRd\4((]Le6MG,2GJYU\TN;&):9(gN)2E=8G)S=)4#1W
BeF<IcT/O6[W-(,EU\K29Jb5U=e),_FUHEf4bRA/?><PYb@PJ.E(b+OJ.B\(We?<
BVCbWT/[Ne8CGZS-T,CW51[#7]bFfWHQ@039_[W1LaS40dL+6GNQ45D22KN?G/MS
\33fWJ9.PNcg[FJ.b^b8-Y_d0UMVcYAg[5c1G@);8\e+^[G;cB.d[cZXIHT<<eM#
)cBfH@>a4T+L]bEYJ]J[H[fQ,:\6R>GJ.NOU8d-bTM5D&-Q45,Y>FWGP&Z=9YbSH
7GJC?f0J.&H:<0CeX)d57-/OZX/:E@:8DgGb3WSD3L;Y-JZa?[QDN4<B\3MKAR7;
V6S:V]KPQVD-Z]@4MRg;9@F9FPMe_<d.R9#/GD/&gg4PdYa+,42L9I9g_:Q:g:3&
U]4]BC9V@g6KK97[?BCR#D-3]^50GUY2P:3X^3UA2T]OGA+P0A=U@TKMSL2;^S&J
=QE,EJLJU6S,-S++gOJPX3BA5<(_fR1d3J2Z.(FGc0QS;FK7EVVRX(NRDZZN<]^(
[RBbI&eZ::@\YW48bGR()D\8)MXC38290/:/1]a3,5T/6TCQP0e>=L=_VU.d2Z46
eSCVf3;.FQ,HUWX5K4D433,\.X.N+__fY0V\BKCWG>(VWD(N3+1.0Q^7_Da;f.@#
;cCR]Z&9;9KJRTd3B:;>+]=\c.-:&WU@BXa/GFJ/C2^7-^Q7U?WH/(7@D3.S^2Rd
+UBSQLgbZNG5UZ#MJ^O9aL0FO+AecYg8F9DLHFT8;1-PWI&\Y96==J8^(YRZa8&I
HdW;?3;,@\b]=UUCU^XYeP@Je-121.D6_]/fd+[[\0_ZB[d]a)\g;d,]-WXeM:Ia
E7_5e@G7e=YgH/5ZH1PG)L&[B80OTLCVBTI_7/8(<A.ReS9:2[:OGaM&M2L1&N4b
3/)N3X7=F8[&d]6G8bBF_a6I>,NYSL8aK/NNA7d8VW^6gF?TQ5B6aP>A#W+_d-\+
a5YJ(CC9QX26O20/^XVO6AD-MR,ENcB(,MS_&e]A8=aFF=Zb8BRUVRHa/\-\(G=Y
>U\dI7NYUB00YC;J-9A0,NIISf;69(LI1UEJM+PK66Jd+E]3X[)G_]I@f,0N1NUb
5N6+M3E^#/)FB2<F1)\-cUef^+_=)3=9f[]W,:J5L2_Q82__XG[8@[.47^+g]:WV
C)-]7B6I0EM8/PN+IBGfC7;Q6E9IY9D6N7>dXdd:^Y/\/9:/^C-J)TNX&&RH;+F0
>W]O7?Ldg-0OdeddG1).2^5VA9<#>Udb:7/H5Z=gKAc?<6;E<J>B;8CAOD2;]O.)
_W[)SGAf3b9ERZ-Qa5W>Z,4\(40MVWZEa1=\H/^G_C[bI-8JeDaFGdZB(RFU_D30
0,#=,9dafbZ,a_UN(-BPX+.5/&Cg<9V7HS<VZF8Y4(&W[U&71NXHNa>0>ePJ4a,S
]XWa&K&J^IA4_A;1=:(B\V=1Z/S=TS[c#^VQ,6G25b]1]fA=_<D@V.(&HF]H#32Y
AVP4P:OF[6dcB]AGWH\@Wf&T#0>W8Od=UOZ@G(\G5,3.<cS:=]>7+2V>Ta4PZJ3+
OS0R9K\Q<NdUB8FYTdBX-[IZ;Q,DPFDQ2AXLJ_Ce_&W8_TMZfYB(].1M)RNF+:43
<A0F,.M(VT761@+c,:F,7Df^9gg5^aXHP@F;][bM2e[+W<3PUL]C1CJ4BS\LK+,8
C(;(51V^ZV]gRI4_+^:QD63H[Z0Qf2+@OI62DG\CPBL>3\?G_H/GdDc1\7Pg#,H_
Z8C0=+Ee3Ze#X[(:b[4gK?[];WK\3#XP8,7Q.S=d61(\.&/?62QLJN8I[.HSc>eX
9H0&UeP^1)[eN3e:KG+L<3YI,24a1L0g^ZO2FQ5@&(TRV;XZ=ULV@WMRTF(HbN5Z
#Bc12)d<X;e]Rg(LV:,4^AKWV(D1<P5OY>,?L8)#fK0/V\V/L&[CL;&^^&BCT9\,
&b\deX?478G\9Q_c2IW2^(KW7$
`endprotected


module _USBAnalyzer #(parameter DEVICE_ADDR=`DEVICE_ADDR, DATA_ENDP=`DATA_ENDP,
                                ADDR_ENDP=`ADDR_ENDP) (
    USBWires wires,
    input logic clock, reset_n,
    output debug_pkt_t debug_pkt_ext);

  default clocking cb_main @(posedge clock); endclocking

  `protected
N[MKfW99e6\L7QA15]X,B@Eg,/]e5]/,U;Bb+LR-e@D<N&_(DEV?))&ZaK^J)P6f
>eC6QNbL[Z;&G/g;)LRP(J&/48>6=7<fAQ#[=3D_#BNFT,F+;Z01IRa40IKC@J0<
BdNB00A56-4N?[TCN1FXT0JM-d4K6.=GZTT/>A1FNPe_S=aDW6/?-0INQD+6QdAa
F\A4XUF)3KP5JdFPN.9;US5.#f<)BZ6F#R9E1Ggda+F^U^@EQU_@)/+;NFZC?Wd/
T6PgF/^7;,RJY)\]ST]CYV=2M\93Z//O^1gA#g[IY_]>d9H:cMd\?R#<dI@#)H_O
\[CH.](c)eF#a&U,9P@,Yg[XIW)(NAc@ZYVV#E,ZUCHRN)O3:d4.bT?M4.)BV,]/
Z4>[=:)?OAKZZCG(.Y(C:5):/UH[_R6;Qe7ZAEdIgR^MUEJ]Ub2-;cbLHF,QE4SW
K7K_bTRNYB<BU&DgMdgM)6Q?6P/JNCW[OKg,+.EfS5-V12DQ6VX44#Q6H+>Jb#1I
g#/:UHC@#Ld@K+^^a:1NS@.<P@^))Zaa1UHbTO4O?C5+CgP6\[V2WGgI;XaFF=dZ
:&bG)7C?^Fb+RQDA8P4I>G11?Kc>K/[gA[3V[f,:]I\(08R=TO,\CYc-@G_@NbBL
UG:B_ZE990;1/GS8_<BHAPE,A-WO;S-.9f,f?O.D(c+d(dQJJ5&e_efd+^DCL.K;
CY9N#fN<ZY&Ua1,WTbTHeO?3fe)[]H/^P9MLPLg^G8[_D9\]e7a/eWT&VeUNLDCF
WOe.SXRDGe;J+P/<7?OG>XJb:(4EU&5OfC4U_T]G(]76SIC#f@BNBefK6CU;Sf6<
HF^,9dSeG)83RGATT\:Rb-cJ&Q[T4_?PLB2,LQa2<)<,VT_g<+IdaB26BLNd&N-9
AGY+g1^WFM/f^JVQ9aFbP-;<V?8\KWDCaB7)AU85[)NXF[.[QN.^F:7BR])H:Zcf
K\RJZe\.e7V26b][0YB2R^)P;R0\@.^LaRb=?dRUf<fFcBW^P0YQ[c#&RIMAIfI:
JHgdLBS-WEJ?]E<df/C@^L(E02?-K18JdT9@O9CGBP-X5BfIYgMTYe,U3&+>&2Kb
POPHSc_\@1195J6RK=:-L1>-0/Kc+>>5g;1^YBUL0Rc,M0_;OKa_62_5UI_g<@B4
g5#N7BWe69gSL?;aDV=FYaZ,3Gc,K:>16PT<)dB/0RZ-F7K&EGUEfBCBS1dW(<BL
YX12)f4b_)9MF;g.>C:Rb_,:\Hba=g]AB#:@.c,ZV;V2IID@0TQa8-KKI#8C9MQa
()Y:.RgRW:Zg3EMa)++2Ca&WQX).66G4=$
`endprotected


  function string fn_encode_bus(usb_bus_t usb_buses[]);
    string encoded;
    string temp;

    encoded = "";
    temp = "";

    foreach (usb_buses[i]) begin
      unique case (usb_buses[i])
        USB_J: temp = "J";
        USB_K: temp = "K";
        USB_SE0: temp = "0";
        USB_SE1: temp = "1";
      endcase

      encoded = {encoded, temp};
    end
    return encoded;
  endfunction

  usb_bus_t current_bus;
  assign current_bus = usb_bus_t'({wires.DP, wires.DM});

  `protected
(HQ3]XLE&R3<FIgeTM?);HR<D9GVfQaWeBEN+d.Z0b7=4d^<5XD9.)>S4#c+6aBS
:#?QAgYX[4dW=0C14=]OVV0V,fXFVT&\.g3TGX,UDMNKKK;M0W>QgfdMfEE8b.]M
fTYNB22bGV#CCL>fP(43..EI12H;M.Z.+^G#LUG9)(3G/@[(La;3N>VbV(1a+;1_
8-CKC@.9:?ZS^O]Q?g2<U+3#9_VEBTe:^#<fNPM\(1a<<4HG399#;YIGd6F-P/RA
&LRT2T2K8(][JVd3.Fg0O):XN+6QVeI[MMP3/deA=#?KL02+LZ&(8EVJH?U+\5\c
gCeUNY;-^[\E77RD&;DNT2/G83_OQ\U&(A?KQc7cHRg>;MMDE6)cQNb1I_.V=:Vb
2+\)LQ/8OZI4:83@O_LMP^IE+X.5VX@Y>^4Y.Padg-V.9gGN2@4@ZE[aAO?)M(8L
X+EHf<D?X>E5d(&1eCG6OU2Z&F5b;M86M7I[1HXe>PWD810XfI&5e/B>PeFAHP,d
4?U+PM@D2(e0JD&],+cH/XP[7]-+3M8ZF#^&R=^GGED\.1W.KE0X5LCcIEM_.1gb
Je=3NS&:f<G@Z)7.?f\D,><VR2>C\Ic_3E>cD<d#W&9IPZQ>7LMb0WNK92<)CKRU
27Aa+JECbUd]7<7+:345Z)DGd,C_F56_4E]/L\@6Z[LHI^.9\F,M-.Q60D/(+2Ea
SU).MQMS8X,M.EBf(YdM<_U(YK_(?cC,))&B3<?9:8Z]QX]W+9_YY5JYFb7C:.4?
S&H2S@[D8a3#H8APG:K5[&f@fOW8N-)02.QD#RN2I]Ja&TI706B>f4dJJE-C)B=g
Q^CM;PY3/>a[3-aZ:5H_c;4g(AXILE;<HK0Z)3adC2R6]1CCB#UOI8#T>K:XF>:#
P2P21(O&S=YEBCL2@b148J?Eb^V5AgdO1(L)H4b.9=]ga2+,\KJFZ-8SI>2@b>^;
NM:cAJ8S_G7>^.DY1XU?1_6&O37)X(+cM-H9OA;4>>KN=DBJLIYVVF0cS4W7>aXN
N3cL&Z-I.(21]8;I-R&G5c3A>Q+:+/aBVb^809XMCcJ56G8LOJ;U>W9\+:?[0)3X
\P/+DD0f7?ZQ+2=CZU\30T4@g)LN0713R4M;0\=#SGJFN_DUM7\QfO;Y9fU)HTR:
JCO#L,AGRg#SeFQ7JE)[d1#>,[A#IJHE)OGRY2+=4P)dd(?6(TIP0F;QQcGYE>.Q
G\<f?SWdYWE\N@I?@0\3X><IfQ]ga83]d/FX?2+,5C:S_T488GZ5QPP1eY\6b5.#
#1OB1PD528Q;TT>)]P[R/^K+(=-W4U?)4F=_Wd:IC\YVHJYDEZ.06,0)Z<Pa2I.>
R2^@,0(IHV;,Y3_?(==@,AY?f28V+JTI-SV)Y(;b(ZXC#gbLa/CCP2XD8,a8DaS9
Q]GK.DAU?8eEU8;Qe9GQg[U-HgcM=CPb;@,\.-_^<6d:;66+78#@/T9D&?_?HCW&
&cd85\5NO427H5,3I>@1E7Y+&1KA^\Y_TZ0W/d5DgT/XVH6@65EU95g@6::0WGa>
R;+;\8KV1?4?O;1@-9=B[?R^,gC.Z?Aa0-\]2fe#\b&,Rg\C_ZVC)8:=N4)NSHRE
E0NMPgUS\Z0&Q^90[#_3Z<HT23?>Be6Ve<9<E8C/[B&_M#;TI_DO+[1RBbZ5gCUd
@a]<G^+^P77_>^F^?_<Y^D.78@dP+E(^P+IO5:b#Z8\,)>66J>\G<FgeS1[<gb=a
O9Wa.aL-A]7C(a3:]G^Naa03<I<3FI,9^eW=Z3c#4LBB8?[,(N:fC6#B8cMEg_;0
2^7UA9bXLUc0c[1G)K)I0M@XN?PEfLa](F=?F^F-]1-^:ND@2b&NH;-bb\.a9B4W
bN63CP[B)c8e@I;9Vf&^;3S.2<S_a-.#V+\OAK9+KIK)>2[c&[9(VOW#/C\MH1Mb
G:1D7A\;Qd142RFKGZ1<G3,YFC1DP&Q[CF)=<^VJ-I/#<cUX<WW#Y;SN^YQ7#/Ea
>bF43DA,:@KSdgB2)OfbELY&G-X>ML]c5PI6@?7HB:^IZY;]?5SO)=K^b]K+YHIB
[W-a)AB-E4B#38G#SV[#LO77Mf\Q-K<]6:=R@)aJdgbdgN8U6P+F(AF1(S\Cd+bY
-b.?>ISA@?18REPY;P)OcH5eJ_?,6Xg#c0&1(T@4&B-eQF:-Y^G0A6=U]26Da#H^
a9.CI1?#\POIe,A_8#4_BK^IWQ7SY<gJ3EN=:3eQ>G6LX@\XJ1,8,Z(AMJT/?CQa
>PdH#4Z\?9gBC+\MP_a(eIKg2+.TDP3//fJeI77EcJ8/?=fW_;f3K_,8:7<BFLF#
f0T4K#=R3PI:Aa,C)V),IAa#^<^\?L-Mc7W4.ePcIZbg&#^a_/9?2?K3B/,(1R55
)dBA+WHQ^G_UgCUOOcHMYMFM\cE\c#PF0U36RcA<+?UMZ1)5<G33CF,=[7P7R3H.
<dW+U=)9bKY,JBB?BHec[T5HNFP.=K)VOYV3EbP7/+YIQ9)RG:M3b8]EM@YHfWS@
H9ZG3ZTQIJ=[adU0f/]cGM./&:1SLVaFNMM9TK\71^@4[23FL[)bH+RV+EPc67(&
KP@38-X[IO>I@FW>\c4S.CF9/1Zfb1VGA\aZ3J=O.I?0UINLC2#J+S5LA_Tb8=8-
RI^1]aLaNSe2VbbS(NXDJSS8TUW3\>#32]8aeg:K/Z/MfX2>3+11]dT?HXN)6(-c
b?dY+I-eK(M6O[gT4X.CCS+:L0_D#HYX[.RX+8O]P-ER2(\eXQ^Q]\@.9X.6M?=d
XGO\K\cFV2c<H)_8ZUNCMR)6.fC:8L[B0,H,96_[=[&:\@9FE;T@R#35?=)^/^af
Z2V40/5Nf+V6J?P_eP._JORO(\a[>89()7[;GXK];HXB?)P=)[Q9VWdR//H.NQ=9
f,?J&L&ICIG+[11=fd##/DR&W>-g<G@MM=D/6(8+We&LdB)E(K;EYA.=1]3BDM\Y
175?P4^3)RD=aH.B>b+?TFBCA(02BeVTSME-@^)3-7&EIZ>[ELYD.be9W\I[<PC2
YbV:f6W330/-,.FEN[^g(66+16?ZaV6#1?56MOgQX?=7^=9HK6EDGQ)>F#Ef/.Hd
()dKfVVa?WFB_g^YWK)G[M[=5&GfU\./A#EG?BE)H)?\AVdXAQ&Y3dZKC:QEUUP^
2CgO42g/E9c>4B,4-cae7.S4:YcZ.CXB6Z07RX=3@P4gBOQ[-1[PO)G#HdVe.5?7
NIQ^C2H&a\&Ua0a.BUQ13acG6Pg+\(E3)PN,YJMDYA8781&?B>CG1ab.Vbggd>L:
T;PabC]]0B==c^7L0Rc9<c=TJI4H>OE6[Ca7RO;L/EP+D69dGBKMQ;I\PIc1&e;V
Q(/EfH,0MEC8]Q,HK06#[R/&(H5=_LVK0_&CE_X_GGa>cD9@C)M5\SfX:66FdfST
E]5)=#@UVQ_P(Vb)H&dH-^>7P-a=KeA0]UOVQ#\^_BP9be?5:LUO1-V4\W@[?\\g
N6F1>;<G53Fb>MG.FY5D5ZY3;Z.eA_\PRAF#d/f@J@R&+TOBUd2GVEd(&8YO?HQ(
O+47.g)H_L0NOZYC47+#;-K@IQLP3e<YT.IB5VE^RE+\SQD&L[+d,@_UaGTF^K1&
N+]&&c.b7;0Z#S38I.XY/=bZ3=XJ(2HY96/b2E,-<\J@KS.a\>>C-L08VcLRQ9-&
5<2]V\WJ3=&([P,7;=NE<a<#P]05Yg8&;]d4#/-_(2@]T9X5#6cR\31Y]5[ffa44
SgBMSJ7+]@1+LKEaX(6=[X0-80=9c1Y[F:Z@H(^04GUCLY\G617EZ<X2a;EB]_fb
-SQJ;\[2bR7DUXD5f^,DP2S.[;G[G;(OY<IR&(J@ME5I\/[8E<?\+.L+I6aX_(=@
3@XXaF]MBdSMWOXMS:.AF<<4=f#V];AB&568_\QKaXYC,eJV,@.&?WeZ8D88Raa_
7MV/[F+D)9263e8e:fJ0##FE.\](/1?3HPG)>8K&a3WNRN1HIg69/L/4)JX+X>g@
5)6bHB2BTTD>+ab=dBY\#(f<QH(+ddN5J<XG97)3V[9dWV35>T7W5?[5Da8c^&.8
C4#VOeORW:V=<+\d1b/=:A>U6DOWPa:)2\(9ca2fB^g8R5>H&0Vb6I:)\ga@L@\.
#0^PZUREJZcGaQP;L9,+^P?;^c4C>WFBUM:6(_4=cc&0AgS:\]0?[Z.1-+H3a<SG
6-RI4>b_1O5e127B>I^S@HM#cL13@=a8;gPVP2_Q.)JcX#]T1[3)&8;R&QGXI\<P
ZE>?^6,4N.Bc]?BY2>5<fWAa^P(XaG12UMDA_RP5I;6]6W0BDf\GIRNOCT55gH#E
D&TNL33[IQgX@YYf^3^2XE6R76gN<PX5HHUSF2T,N_,NHbHKO/(JfBg[#fLJ6E9P
X9<-F_()OCUSg+B<fN/8UFIR96RX7V<:;]SAd.+g(R8F3Y8QTLD(C+\d3Ha12Q(c
=I]:U&?Fg<K\SWHfM&aJH^REZ8NZC7gQ+]YgVW;VV6=R//LTT\<F@4fe8S]Q^,DU
2C-ggX<PeR/4=4C?D&?;FO6,e&_P;-0_JW@<6-2Mf(3AGQS8#Z(E#./CD[PZR]YG
N7ZB#9XX:\bK3a4RCUXX,N+X,U0.MG4)7H[5GZ0:3PBHOdI2G\-6PK9;BCa[#H@+
])@.QF33-/C9M-MF,DC0I\RdE;LF5D)Ec.ccL^&URAaZJ1H8641@gMc(#eW,)1BL
+JC>&\c,DD,F^J@dEUP@16^N\W2(5#[MIF<N&#\LeWP;3CS1R.X@UB1R_1X5,V8e
aYe9ZJ>ZF)WC4JRZ[UPG_A#PLT>3D^/8F;X1ME;.,^g>1H(WbAdcE\<-dW]B^4Z@
68aO8ID-C)=dH2=-,7C-U(-fA.T/#;[T#0X>geYP[,5S)_37/g3:G@/T\:([+TS[
-<L-C#^_NM-M^FB].J1YR)25a[3GNfGH?dMXc9_d<_-:P,(P#1S0Q7bT#,[cfN/b
+H#?[HS-&a,T(@.;.)AJ6JREM\1C;+DaT)=eR:YYCX5VLc+0@PY@e5QdSKX2NbNU
L-KPOW]LSH&+?eMH#A3g(&5)ZFD[Q4IR8d8He)dO>S=;/52eQD4NO\4=/OJ5K(F+
YdQ]&5](=;Z_O2-.dc5B;AA()H2A13XMJeH0L,Yed0L@a->bSc3d)AbQ_@Y&3LdL
.UE;_2J[PZc+\>/[WV^M9#GHK4U895:4CNO]A-8QdcLM6c:U-XCEP]F\@ZNf#ZO&
aBQ(-d:@1U9PAKVB>VM,fdK7JBX+E5:be_,bI&0KY&U:c>6K.O6SQY<4EMSC7Cb+
(PR0\A\?QI\#DB>J/0K^gHIf@:bg0:?5CRQKfG0S-GcL679?=M>W9&X4BX_N-a7H
6Q&YH)VTE2g(HgJ94+4(\fT-_,4JGTPGdTAb<Q76T;MD<2e65Xff.@55KSCIc1&Z
TOJEQR6[6P(&E(U.<@eY[KFAA^YF]SL?fZU5UOKY[AQgXVQ)XF.DQ:c@?_/5;3KQ
I+N<IgN?MF,9_XGO=Je5;MOR4[U3PG-YAZW7YLQ0UB;]g)X81K/Nb4Z,,@9]YeJ?
[63.b#JIXaW>O4<(]K-U^XE170#c_dJS.C.<8I^fg2e3,-_+@YQ3J[:=7WHD7.=A
+W_f-;\/Z8&0e4BX8,GVf5.VW,U;<6#<@L>NBO&KP3HKPZ_0,T>[6f>./T,E3?bS
Ra[I?=@9EMZ(CB+O(7_)^=\cPO:LQ)GRAUR824D]G29Jg(PE;^\_(@O<bb>QaBH4
7M7P;7X089^&)-E+EEb=XQ;[49CQ-gQUHIdBV;>10gd<2\[A9eK(L?4fL>?1/JL5
BOcfS1Zf61P[U?KE0d,-D;3Kd;\)ZRMa3Af>F__b;7EP0CG#&WI8-OU#9#eDOJ>?
GTP3@ETBC3C-/BT-<,@[<;L&@9PO+&Y,ZH8KP^4bXc5[:Ng[3S5+6P(Ac?5H<CQ&
gBQMRCH8F9G5,>Wd.\LB,/N7C\.HTBe(QEMUd@eC0R+24?>=(PZb,R2:=J]dUHE4
,Y+R@J)W[:TZQZT&f.NcCO0JWc-^^3g0/c&[Hd[7+ISW)7F52T0=d+18)C6Vc1ee
YYK:8)=48<K4L8dWQFQZCTI^[U<<A5XSHPg+<YU8.Rb+3YWb4YC/E+8Z[863<8+E
VaTWE<b-[K6ZFC?AMBNK0[YHKgTM)4S8NW?#E5(ZU9M)NA=?e_-<<(RLNQY7G6AZ
[4de?VT1XYEZ>#<&gQ0_Q\,J_U4NW3#WE7QW:b::ec#37<_:?I?dR6(B9d]b.c#E
#)Q]81&+O=eAg+5M6PG)&abSD(BJf?3WHf+04Bf69;6\>\c]5?bLWC4VXT[_WF:&
.Z]#QNJ-M82BG-D+]E2]903F>]W4J#\6]?YJDaW03)POK)-^P@4NRSgZM-b_3<6Z
EGRb,a7W-JgF2.STTD)O9\K@(+KLS6=8=0g8LP\3Tea:+O#4fM+SfWAVUGb[=4Z;
MU^?ZN(X_:VDe:N.N&\c3HG,4&X@<U:QO<J>3;1WcFF0NA+636c9YXU6[.DfIC[A
BeG45^.a55YGV8<EEa1U&6eL7?LX5](A^5I@dbA79bX:A]8CbHJEcY5P0=@C9&;.
LT.cB:</Q]UIY+)4FT\Y1_AM((a?b(4\7@FL7fY[e)<QWf=)7E7:TAEIH1G#bg=6
@))SZUS;XcP+d6_UbIQJXgNS=&TCB:V[-,1SgLg8?J^=C+9b#64)g]H1df_Xfe23
J36YZ<SaWZ-IWL[ALEQW/T[#0MP1-00.)U1BJ]L)FVMe4&c^?F]GeT4Z1+W&:?J#
>4S_9Fa8;I6&@[J&TQPf:I34K(G;+SE#&@eQbU0[g1ggE8S]9IR9cSN8327VNV\[
D)@(>Zb.&GGMV#VCA-C#e>+/+QTN3.;[3CX]?1.D0AXS_S[3bIcVD0^d=NIO0Z(&
A&;O;3gGN[dU5V[[ZBV[)c8GeOBRI]dBM+T05E>fNga&C(&\\DZZa:G==TPY/:FS
d,H@]DJO,A>9]<0&[)^c(0FX9D_#(.@#W=bQ5N#P0/:14PIW/QNI3SF]=9fR];P.
]bGeUE#+AJ]\:0AP:9R,ZA\aYN_/adHV=DLY+17>1CPL@;ab+?dIX.PE5>dg<Jf+
)X<aRIFPc^Ff2[XQ3BDWD@;FR01E39JW_EF-WCKW@)),N@O_W8_,RQNYF>TR8LLD
3^bBe[\e>]1JQ@=[SF?:]2VDBOaB53a47GQ&faNHFXU9(2Y7a3(c_?gb?26Q6:eA
)=LPG+(RPWeTH,2,1c:6P_CDJ-QBEG50?.CK-7VEDKJ5EME[,57[YLAaQ^eeZd)7
=L6QOM\A#]JHF]#dbD)\CF/Ubb.9BVNCgH0a2^@59]=)NgQ?X&8?8GM6I+#DX(d]
faS1DSOYZJ4gD&_bb^+;AA#:I-._XV^b-P5X])24:]Z+ME,?ZeTZREG0URVQ524X
&O;.(IIHb))KcN;.>=X9V2Pg_gAG?.5_\1E=W_(@X.e=a]<(g14Y,RB5LR4:;[1_
G/>[\NN<a0I19SfH>6U3PPK(^4Y6_OZAc_R@&M/6.BG^X(T-_(0XdBPPQc1a3I@U
00YKa:d,Kd^O./Q;AC1GDO_/=J]0N&]><G^[7GC_K7TYCbNORB^c398Ua]K,(@@H
[1>?NR<V[M_0#LadPJ;+71^bX.]ePE@OWaR4JTK00_?U+V)f8d8>(I>4Le:RQ(41
JLD[<(V,:;XE..L>TQ_7FX+4)NKITI\S0TN,/#g1c]V4TWOeY&3L;9ON_Z;I-[Y9
4g.ZWOT1a)C6NGEd-;dWI>dS&XA]=+^cWVK6FE@GJ]2<SPYM6>A1&EH;3g]5&(LH
JWaa>V/?<c^GOAN1MDf3=8f)5U:.I/[PcV+#0RXA^V0=#)EP4T]&-O@UdCC&MI7+
)c)a]LEXY3NP?\2IQ4Gd]1aI,49=acM#L0^(-.6+V9EI0f1\BK;.?>>7L,Ne0=MB
Z+JOG_UI@Pgf&4>JaUVO?RL7,JZ9I<4g=IY62FcBQC,/@8fC^^S8Fc6(Y01XZPgN
D3&5g7&5WPOL__aA5[GYD<dMUG1b45]?1M70O<Q<6g#AYPgS6G-HI/.X\&07SNcQ
MXC2<(W=\\GcA+J3c4UC+)dM4E@J9/5V/d]M_+Jc_YXNcF@&[@:<BHF]cDG+V_KH
=[RU&0+_a=\91=^Y>Wg<1c5G)YHYe9-GC&5+WYA/HG2@,_MAf5)8B=U5H\]JADJX
XI5499@Z1D]WQS3MbG=N:K94BWbQ6^REAR+HOd6<01(P9R6C3>eKccZ#_W>f86-8
)0-:6,\RZJaO)A+#cIT^)93dRG0da+FY9^\eX+2[@RXZdf\W84KNO:+R4O:\_B<g
Q^MLGg4@aW]=O[8;>c[:<R)ee>?R61H6cN/\b:+bG.4/F/0/0fTZgd.&RH=d3bD2
V9ZV2Fe8=GSO)18/NJ&L-DYHNP?F5IHfGAIK()R9-dHO=.gL3.:^;(]6SAB/N_P]
OD:3Zf0:<]MP?[=6e0\DQTL]/b7gQDSPQ[a_;<QWP-[AM]J:EfWZ>/08^8ASO;Kg
CQEQR7I&)SD__R^=-(&NRW7\2<\c60[QT/2cUA1NT]U)Z>5U5YBH7IC>[e/a()P:
\XLN7GDXAdOBWQWHYF]\>7.>MJ5I4<@[?.gb^,K5WRR&9UGfGF[F4-TbNgSV7gVQ
-1?2fc&<:>SI5D<eW<TG3BM=TIVPFfVc3OY0]9ESgC;MPU>-B04@dRXWOEB?EDU-
bEL?dRQG&G>fA2W#ZR:.(K>I)_<I0<S<UCFA9a=L<:NN9(&Z=CC@Q#d)RX0A5B:c
-D@\SdcPB3_TE4(NQGA5DQ7E,5B/\#I)3baJNLUT:]1]SOGdc87)8e/DZS#0SXGA
?K(L404_\dd2LFW,7S_<U]dKX4gM6(LC(Fd-8_&09.b5bJ2-[]^>CK:4C4,e\#B_
g8S2)?X.7C8I<IE]_3HZA2ba/aG6ge421;)519Rg#&Ve0+HQ^FI4cBbE.g3O6e0=
gM&_b1+@a[T)C(3(54V>L]<VNO.0VZR@F6FKX3G]5\8&,]U@]F.aDeBLDA4GF[5.
23>WgQR-8GVb0UEB)+JG4LaKHdAB2<LbIIO?P.R:^HZVX?FJILc-48#J)<=;5BJb
5G-@1S,bP7+7KXV\5]d2M]);c-_095>NCC]?:cf7NOcBKKCDK=[d7&)2J-YBE1#R
__53JX^5222ZAXK.:UY0880:4BML._IZXJF7>c>WdDV:H96UX5?31-&5M857K6M,
X5bN1^G[@#KRU3<XfTA8OVZcT^a&g,)U0B,?X5W:?Eg8)D]F]AUS0E5;9EgJLd\+
f/QB@e]20>c.@adHV=NR_)U,3Pc9De6a@6dI>LEY5Q&\d/_IO27:<aKc)YbTK=g8
QE.4V.&<YQBP=9Jg2;?[Y>UTNbAGVLg_#dgf=P92c2TN[A81Be(2UKW-HB).,4#T
@8J::6;(^XP,^[UeI3_g2\:VCNU;3ZHE4I&/c29W432),,98NH4R97aBTDc)9M[b
CMf<HL7:f=g=Fb^_B8>/<D),&J_&0^T@/QA=FRUeE/620eLEH#S_Jc/11Q3GIPPE
TY9+6[(0WJF-NO7RZ/#XO:>QI_N1N>dDZ(e(<SA1+\WP\:N>RR23A[^>FD_6(a_D
71aNd.GOWcb=>5EWP=R=?9]7P>^CW/L7f-2#U^Y@@9H80?DTERPRTNb-:PbY]7@O
8dIT^4fBYKbPZPYR5;[aG(Tb#HS<:1(#TNM^\a+/3S+c]0]NL=?b;IFF7W\TeY<^
4B/W;.]3S;H1=\)6AcI/O[0M.=>U?_C?9QDX,;ILb7A5RD:0K##VKdd\QP08,/P.
2P<D45.I9+<8JN@d@-CAM=KN>P,N2J0&MZ1WSJ_VS3EV9#T<CW(a9E4VBQP]BTP/
ST9,)(A<MYe;/R9((M+8W]MIb9>GF&,#=)[JfYE:D3,HN24FHMO&MHcQ7a)gZ9E[
N?8DDg1&0Bg(;4[-6LF4=[f8:H,1#+b\JJ]C]MZcf\5UbDf3O;eN4]#SS>RLZ0@H
dX842N/CJ+ZZ\ZJ#J:.<VeGd@[Z1@:EZcLKE>E(JW]Db.>LJ87.TT>W-+PE4#^b[
b7CH5XIG4\bGMcJ]=/BMRY_Teg1bGIIP9$
`endprotected


  /*--------------------------------------------------------------------------
   * Concurrent Assertions for USB Protocol
   *--------------------------------------------------------------------------*/
  chk_valid_bus: assert property (
    disable iff (~reset_n)

    `TRUE |-> current_bus inside {valid_usb_buses}
  ) else begin
    $error("!!! %m: USB analyzer detected invalid bus state DP=%b DM=%b",
           wires.DP, wires.DM);
  end

  chk_bus_turnaround: assert property (
    disable iff (~reset_n)

    $rose(chk_eop) |-> ##3
      current_bus == USB_J
  ) else $fatal("!!! %m: USB analyzer detected no bus turnaround cycle");

  chk_stuffing: assert property (
    disable iff (~reset_n)

    (en_stuff & serial_raw) [*6] |=>
      ~serial_raw
  ) else $error("!!! %m: USB analyzer did not detect stuffed bit");

  chk_sync: assert property (
    disable iff (~reset_n)

    $rose(ld_sync) |-> ##(`SYNC_BITS)
      debug_pkt.sync == `SYNC
  ) else begin
    $fatal("!!! %m: USB analyzer detected invalid SYNC %b", debug_pkt.sync);
  end

  chk_pid: assert property (
    disable iff (~reset_n)

    $rose(ld_pid) |-> ##(`PID_BITS)
      debug_pkt.pid inside {valid_pids}
  ) else begin
    $error("!!! %m: USB analyzer detected invalid PID %b", debug_pkt.pid);
  end

  chk_pid_n: assert property (
    disable iff (~reset_n)

    $rose(ld_pid_n) |-> ##(`PID_BITS)
      debug_pkt.pid_n == ~debug_pkt.pid
  ) else begin
    $error("!!! %m: USB analyzer detected invalid PID %b PID_N %b",
           debug_pkt.pid, debug_pkt.pid_n);
  end

  chk_addr: assert property (
    disable iff (~reset_n)

    $rose(ld_endp) |->
      debug_pkt.addr == `DEVICE_ADDR
  ) else begin
    $error({"!!! %m: USB analyzer detected token packet with invalid device ",
            "address %0h"},
           debug_pkt.addr);
  end

  chk_crc5: assert property (
    disable iff (~reset_n)

    $rose(ld_crc5) ##1 $fell(ld_crc5) [->1] |->
      debug_pkt.crc5 == fn_crc5_nr(debug_pkt)
  ) else begin
    $error({"!!! %m: USB analyzer detected token packet with invalid CRC5 %h ",
            "(correct %h)"},
           debug_pkt.crc5, fn_crc5_nr(debug_pkt));
  end

  chk_crc16: assert property (
    disable iff (~reset_n)

    $rose(ld_crc16) ##1 $fell(ld_crc16) [->1] |->
      debug_pkt.crc16 == fn_crc16_nr(debug_pkt)
  ) else begin
    $error({"!!! %m: USB analyzer detected data packet with invalid CRC16 %h ",
            "(correct %h)"},
           debug_pkt.crc16, fn_crc16_nr(debug_pkt));
  end

  chk_eop_bus: assert property (
    disable iff (~reset_n)

    $rose(chk_eop) |->
      current_bus == USB_SE0 ##1
      current_bus == USB_SE0 ##1
      current_bus == USB_J
  ) else $fatal("!!! %m: USB analyzer detected invalid EOP");

  /*--------------------------------------------------------------------------
   * Full USB Protocol Assertion
   *   seq_error: Corrupt DATA0 followed by NAK
   *   seq_out_timetou: Legitimate timeout on DATA0 during OUT transaction
   *   seq_in_timetou: Legitimate timeout on DATA0 during IN transaction
   *
   *   Sequence repetition operators:
   *     ->#: GOTO repetition; may be false for an arbitrary number of cycles,
   *          then matches on the last instance
   *     *#: CONSECUTIVE repetition; must be true for a specified number of
   *         cycles
   *   Sequence events:
   *     $rose( ): POSEDGE; only match on the first assertion of a signal
   *     $fell( ): NEGEDGE; only match on the first de-assertion of a signal
   *--------------------------------------------------------------------------*/

  sequence seq_error;
    ##1 $fell(en_pkt_inbound) [->1] ##[`EOP_BITS-1:`EOP_BITS]
    $rose(done_receiving) && debug_pkt.pid == PID_DATA0
                            && debug_pkt.payload[47:0] == '0 ##1
    $fell(en_pkt_inbound) [->1] ##(`EOP_BITS-1)
    $rose(done_receiving) && debug_pkt.pid == PID_ACK;
  endsequence

  sequence seq_out_timeout;
    $fell(en_pkt_inbound) [->1] ##[`EOP_BITS-1:`EOP_BITS]
    $rose(done_receiving) && ~recv_error && debug_pkt.pid == PID_DATA0 ##1
    current_bus == USB_SE0 [*(`TIMEOUT)];
  endsequence

  sequence seq_in_timeout;
    current_bus == USB_SE0 ##[(`TIMEOUT-20):(2*`TIMEOUT-1)]
    $rose(done_receiving) && debug_pkt.pid == PID_NAK;
  endsequence



  chk_protocol: assert property (
    disable iff (~reset_n)

    /*
     * Read/write transaction always starts with an OUT transaction to provide
     * the memory address
     */
    $rose(done_receiving) && ~recv_error && debug_pkt.pid == PID_OUT
                          && debug_pkt.addr == `DEVICE_ADDR
                          && debug_pkt.endp == `ADDR_ENDP |=>
      // OUT ADDR transaction
      (seq_error or seq_out_timeout) [*0:7] ##1
      $fell(en_pkt_inbound) [->1] ##[`EOP_BITS-1:`EOP_BITS]
      $rose(done_receiving) && ~recv_error && debug_pkt.pid == PID_DATA0
                            && debug_pkt.payload[47:0] == '0 ##1
      $fell(en_pkt_inbound) [->1] ##(`EOP_BITS-1)
      $rose(done_receiving) && debug_pkt.pid == PID_ACK ##1

      // OUT or IN DATA transaction
      $fell(en_pkt_inbound) [->1] ##(`EOP_BITS-1)
      $rose(done_receiving) && ~recv_error
                            && debug_pkt.pid inside {PID_IN, PID_OUT}
                            && debug_pkt.endp == `DATA_ENDP ##1
      (seq_error or seq_in_timeout or seq_out_timeout) [*0:7] ##1
      $fell(en_pkt_inbound) [->1] ##[`EOP_BITS-1:`EOP_BITS]
      $rose(done_receiving) && ~recv_error && debug_pkt.pid == PID_DATA0 ##1
      $fell(en_pkt_inbound) [->1] ##(`EOP_BITS-1)
      $rose(done_receiving) && debug_pkt.pid == PID_ACK
  ) else begin
    $error("!!! %m: USB analyzer detected invalid sequence of packets");
  end
endmodule : _USBAnalyzer

program _USBTerminal (
  input logic clock,
  input logic wait_stuffing, en_pkt_inbound, serial_se0, serial_raw,
  input debug_pkt_t debug_pkt,
  input usb_bus_t current_bus);

  default clocking cb_main @(posedge clock); endclocking

  usb_bus_t debug_usb_bus[$];

  integer debug_level = 0;
  initial $value$plusargs("VERBOSE=%d", debug_level);

  initial begin
    string bitstream_str;

    forever begin
      debug_usb_bus = '{};
      bitstream_str = "";

      @(posedge en_pkt_inbound);
      ##1 ;
      $display({"=================================================\n",
                "%m @%0t: USB analyzer is interpreting a new packet"}, $time);

      while (en_pkt_inbound) begin
        debug_usb_bus.push_back(current_bus);

        if (wait_stuffing) begin
          if (serial_raw) bitstream_str = {bitstream_str, "?1"};
          else bitstream_str = {bitstream_str, " "};
        end else begin
          if (~serial_se0 & ~serial_raw) begin
            bitstream_str = {bitstream_str, "0"};
          end else if (~serial_se0 & serial_raw) begin
            bitstream_str = {bitstream_str, "1"};
          end
        end

        ##1 ;
      end

      repeat(`EOP_BITS-1) begin
        debug_usb_bus.push_back(current_bus);
        ##1 ;
      end
      debug_usb_bus.push_back(current_bus);

      if (debug_level > 2) begin
        $display("Raw Bus Traffic: %s", fn_encode_bus(debug_usb_bus));
      end
      if (debug_level > 1) begin
        $display("Bitstream:       %s", bitstream_str);
      end
      if (debug_level == 3) begin
        $display("Packet: %p", debug_pkt);
      end

      unique case (pid_t'(debug_pkt.pid))
        PID_OUT: begin
          $display({"%m @%0t: USB analyzer detected *OUT* with ADDR=%0d ",
                    "ENDP=%0d CRC5=%x (correct %x)"}, $time, debug_pkt.addr,
                    debug_pkt.endp, debug_pkt.crc5, fn_crc5_nr(debug_pkt));
        end

        PID_IN: begin
          $display({"%m @%0t: USB analyzer detected *IN* with ADDR=%0d ",
                    "ENDP=%0d CRC5=%x (correct %x)"}, $time, debug_pkt.addr,
                    debug_pkt.endp, debug_pkt.crc5, fn_crc5_nr(debug_pkt));
        end

        PID_DATA0: begin
          $display({"%m @%0t: USB analyzer detected *DATA0* with PAYLOAD=%x ",
                    "CRC16=%x (correct %x)"}, $time, debug_pkt.payload,
                    debug_pkt.crc16, fn_crc16_nr(debug_pkt));
        end

        PID_ACK: begin
          $display("%m @%0t: USB analyzer detected *ACK*", $time);
        end

        PID_NAK: begin
          $display("%m @%0t: USB analyzer detected *NAK*", $time);
        end

        default: begin
          $display("%m @%0t: USBAnalyzer could not interpret packet", $time);
        end
      endcase

      $display("=================================================\n\n");
      ##1 ;
    end
  end
endprogram : _USBTerminal
